function easyEmailVerifyAndFormSubmit(t){if(1!=t.disabled&&!t.classList.contains("disabled")){let e=t.form,o=e.querySelector("input");var d;checkMandatory(e)&&(d=o.value,/(.+)@(.+){2,}\.(.+){2,}/.test(d)?(t.disabled=1,t.classList.add("loading"),setTimeout(function(){t.disabled=0},6e3),popupFormCodeNew(t)):(o.setCustomValidity("Email not valid"),o.reportValidity()))}}const popup_form_code_back=document.getElementById("popup_form_code_back"),popup_form_code=document.querySelector("#popup_form_code"),popup_form_code_message=document.getElementById("form_code_message"),popup_form_code_digits=document.getElementById("form_code_digits");var popup_form_orig_input;function popupFormCodeShow(){document.querySelector("body").classList.add("noscroll"),popup_form_code_digits.querySelectorAll("input").forEach(function(e){e.addEventListener("input",popupFormCodeChanger),e.addEventListener("focus",popupFormClearThisInput)}),popup_form_code_back.classList.remove("hidden"),popup_form_code.classList.remove("hidden"),popupFormClearAllInputs(),popupFormEnableAllInputs()}function popupFormCodeHide(){document.querySelector("body").classList.remove("noscroll"),document.getElementById("form_code_send_again").classList.add("hidden"),popup_form_code.classList.add("hidden"),popup_form_code_digits.querySelectorAll("input").forEach(function(e){e.removeEventListener("input",popupFormCodeChanger),e.removeEventListener("focus",popupFormClearThisInput)}),popup_form_code_back.classList.add("hidden")}function popupFormClearThisInput(e){let o=e.target;o.value=""}function popupFormClearAllInputs(){for(let e=1;e<=6;e++)document.getElementById("form_code_"+e).value=""}function popupFormEnableAllInputs(e){for(let e=1;e<=6;e++)document.getElementById("form_code_"+e).disabled=!1;document.getElementById("form_code_1").focus()}function popupFormDisableAllInputs(e){for(let e=1;e<=6;e++)document.getElementById("form_code_"+e).disabled=!0}function popupFormShowMessage(e,o){"msg"==o?(popup_form_code_message.classList.add("tgreen"),popup_form_code_message.classList.remove("error")):(popupFormDisableAllInputs(),popup_form_code_message.classList.remove("tgreen"),popup_form_code_message.classList.add("error")),popup_form_code_message.innerText=e,popup_form_code_message.classList.remove("hidden"),setTimeout(function(){popupFormClearAllInputs(),popupFormEnableAllInputs(),popup_form_code_message.innerText="",popup_form_code_message.classList.add("hidden")},2e3)}function popupFormCodeChanger(e){let t=e.target;if(1==t.value.length)null!=t.nextElementSibling&&t.nextElementSibling.focus();else{if(6!=t.value.length)return void popupFormShowMessage("Code not valid","err");{let o=t.value;if(isNaN(o))return void popupFormShowMessage("Pasted code not valid",err);for(let e=0;e<6;e++){var d=e+1,r=o.slice(e,d);console.log(d+"--\x3e"+r),document.getElementById("form_code_"+d).value=r}}}let o="";for(let e=1;e<=6;e++)o+=document.getElementById("form_code_"+e).value.toString();e=document.getElementById("form_code_email").value;6==o.toString().length&&0<e.length&&(console.log("ok sending code: "+o),popupFormCodeCheck(o,e))}function popupFormCodeNew(e){let o,t,d=!1;"form_code_send_again"==e.id?(o=document.getElementById("form_code_email"),t=o.value,d=!0):(o=e.form.querySelector('input[name="email"]'),t=o.value),str="q=newcode&email="+t,fetch("/register/emailVerifyCode.php?"+str).then(e=>e.json()).then(e=>{if(document.querySelectorAll("button.loading").forEach(function(e){e.classList.remove("loading")}),document.getElementById("form_code_loader").classList.add("hidden"),console.log(e),e.hasOwnProperty("e"))d?popupFormShowMessage(e.m,"err"):(o.setCustomValidity(e.m),o.reportValidity());else{if(d)popupFormShowMessage(e.m,"msg");else if(document.querySelector("#form_code_email").value=t,"verification_needed"==e.d)popupFormCodeShow();else if("verification_jump"==e.d)return void(location.href="/register/hotelreg");console.log("new code created email sent")}}).catch(e=>{document.querySelectorAll("button.loading").forEach(function(e){e.classList.remove("loading")}),document.getElementById("form_code_loader").classList.add("hidden"),d?popupFormShowMessage(e,"err"):(o.setCustomValidity(e),o.reportValidity())})}function popupFormCodeCheck(e,o){document.getElementById("form_code_loader").classList.remove("hidden"),popupFormDisableAllInputs(),str="q=checkcode&email="+o+"&code="+e,fetch("/register/emailVerifyCode.php?"+str).then(e=>e.json()).then(e=>{document.getElementById("form_code_loader").classList.add("hidden"),e.hasOwnProperty("e")?(popupFormShowMessage(e.m,"err"),document.getElementById("form_code_send_again").classList.remove("hidden")):(popupFormCodeHide(),console.log("Code Valid"),location.href="/register/hotelreg")}).catch(e=>{popupFormShowMessage(e,"err")})}function popupFormCodeNewResend(e){e.classList.add("hidden"),document.getElementById("form_code_loader").classList.remove("hidden"),popupFormCodeNew(e)}popup_form_code_back.addEventListener("click",function(e){popup_form_code.contains(e.target)||popupFormCodeHide()});
