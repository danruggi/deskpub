function reportSelector(r){let e=document.getElementById("reports_results_container"),o=e.querySelector("#reports_results"),t=document.querySelector("section.active form");var l=t.querySelector("input[name='current_page']");let s=t.querySelector("input[name='tot_pages']"),i=t.querySelector("input[name='csv']"),n=t.querySelector("input[name='method']").value;var a=r.max_results,c=i.value;if(console.log(n),"reports_rooms"==n)callReportsRooms(r);else{if(e.classList.remove("hidden"),1==c)return Array.from(Object.keys(r.all_res_limited)).forEach(function(e){"reports_bookings"==n&&(r.all_res_limited[e].state=booking_states[r.all_res_limited[e].state]),"reports_customers"==n&&(r.all_res_limited[e].state=customer_states[r.all_res_limited[e].state],r.all_res_limited[e].title=customer_titles[r.all_res_limited[e].title],r.all_res_limited[e].idtype=id_types[r.all_res_limited[e].idtype])}),downloadCSV(convertToCSV(r.all_res_limited)),void(i.value=0);Array.from(o.querySelectorAll(".result")).forEach(function(e){e.remove()}),Array.from(o.querySelectorAll(".header")).forEach(function(e){e.classList.add("hidden")}),o.querySelector("."+n).classList.remove("hidden");let t=r.count[0].count;e.querySelectorAll(".total_results").forEach(function(e){e.innerText=t});c=l.value,l=Math.ceil(t/a);s.value=l,e.querySelector(".page_infos").innerText=c+" of "+l,"reports_bookings"==n?callReportsBookings(r.all_res_limited,o):"reports_customers"==n?callReportsCustomers(r.all_res_limited,o):"reports_payments"==n&&(a=r.count[0].total,callReportsPayments(r.all_res_limited,a,o))}}function callReportsBookings(e,t){let r="";Object.values(e).forEach(function(t){Array.from(Object.keys(t)).forEach(function(e){null==t[e]&&(t[e]="---")});var e=t.state;r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r+="\t<li class='grid-container mb1 result' style='grid-template-columns: 2fr 1fr 2fr 2fr 2fr 2fr 2fr 2fr 2fr 2fr 2fr 1fr'>")+"\t\t<div>"+t.name+"</div>")+"\t\t<div>"+t.pax+"</div>")+"\t\t<div class='small'>"+t.insert_date+"</div>")+"\t\t<div>"+t.arrival_date+"</div>")+"\t\t<div>"+t.leave_date+"</div>")+"\t\t<div>"+t.checkin+"</div>")+"\t\t<div>"+t.checkout+"</div>")+"\t\t<div class='st-"+e+"'>"+booking_states[e]+"</div>")+"\t\t<div>"+t.channel+"</div>")+"\t\t<div>"+t.rnames.replace(/,/g,"<br>")+"</div>")+"\t\t<div class='bold p0'>"+t.balance+"</div>\t\t<div class='flex-centered'>")+"\t\t\t<a href='/workspace/booking.php?bid="+t.bid+"'>")+"\t\t\t\t<img src='/assets/icons/user-solid.svg' class='filter-green pointer' width='16' height='16')>\t\t\t</a>")+"\t\t</div>\t</li>"}),t.innerHTML+=r}function callReportsCustomers(e,t){let l="";Object.values(e).forEach(function(t){Array.from(Object.keys(t)).forEach(function(e){null==t[e]&&(t[e]="")}),console.log(t);var e=t.state;0==e.length&&(states=0);let r=t.idtype,o=(0==r.length&&(r=0),t.title);0==o.length&&(o=0),l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l+="\t<li class='grid-container mb1 result' style='grid-template-columns: 1fr 2fr 2fr 1fr 2fr 2fr 1fr 2fr 2fr 2fr 1fr 1fr'>")+"\t\t<div>"+customer_titles[o]+"</div>")+"\t\t<div>"+t.name+"</div>")+"\t\t<div>"+t.email+"</div>")+"\t\t<div>"+id_types[r]+"</div>")+"\t\t<div>"+t.idnum+"</div>\t\t<div class='flex-centered'>")+"\t\t\t<span>"+t.street+"</span>")+"\t\t\t<span>"+t.city+" - "+t.cp+"</span>\t\t</div>")+"\t\t<div>"+t.country+"</div>")+"\t\t<div>"+t.last_checkin+"</div>")+"\t\t<div>"+t.last_checkout+"</div>")+"\t\t<div>"+customer_states[e]+"</div>")+"\t\t<div>"+t.visits+"</div>\t\t<div class='flex-centered'>")+"\t\t\t<a href='/workspace/customers.php?cid="+t.cid+"'>")+"\t\t\t\t<img src='/assets/icons/user-solid.svg' class='filter-green pointer' width='16' height='16')>\t\t\t</a>")+"\t\t</div>\t</li>"}),t.innerHTML+=l}function callReportsPayments(e,t,r){let o="";Object.values(e).forEach(function(t){Array.from(Object.keys(t)).forEach(function(e){null==t[e]&&(t[e]="")}),o=(o=(o=(o=(o=(o=(o=(o=(o+="\t<li class='grid-container mb1 result' style='grid-template-columns: 2fr 2fr 1fr 3fr 2fr 1fr'>")+"\t\t<div class='small'>"+t.insert_date+"</div>")+"\t\t<div>"+t.name+"</div>")+"\t\t<div>"+t.service+"</div>")+"\t\t<div>"+t.note+"</div>")+"\t\t<div class='bold'>"+t.amount+"</div>\t\t<div class='flex-centered'>")+"\t\t\t<a href='/workspace/booking.php?bid="+t.bid+"'>")+"\t\t\t\t<img src='/assets/icons/user-solid.svg' class='filter-green pointer' width='16' height='16')>\t\t\t</a>")+"\t\t</div>\t</li>"}),o=(o=(o+="\t<li class='grid-container mb1 result' style='grid-template-columns: 8fr 2fr 1fr'>")+"\t\t<h4 class='ta-c'>Total Amount in query</h4>\t\t<h2 class='m1'><span class='tred m1'>"+t+"</span></h2>")+"\t\t<span></span>\t</li>",r.innerHTML+=o}function callReportsRooms(e){let t=document.querySelector("#reports_rooms_container"),l=(t.classList.remove("hidden"),document.querySelector("#reports_rooms_privates_results")),s=document.querySelector("#reports_rooms_shared_results");Array.from(l.querySelectorAll(".result")).forEach(function(e){e.remove()}),Array.from(s.querySelectorAll(".result")).forEach(function(e){e.remove()});var r=document.getElementById("room_sd").value.split("-");document.getElementById("room_ed").value.split("-");console.log(r);let i=str_priv=str_dorm="",n=pay_dorm=0;Object.values(e).forEach(function(t){Array.from(Object.keys(t)).forEach(function(e){null==t[e]&&(t[e]="pays"==e?0:"")}),console.log(t);var e=t.type,r=t.pays,o=(i="\t<li class='grid-container mb1 result' style='grid-template-columns: 2fr 1fr 1fr 1fr'>",i=(i=(i=(i+="\t\t<div>"+t.name+"</div>")+("\t\t<div>"+t.bids+"</div>"))+("\t\t<div>"+t.customers+"</div>"))+("\t\t<div class='bold'>"+r+"</div>")+"\t</li>",parseHTML(i));0==e?(n+=parseInt(r),l.appendChild(o)):(pay_dorm+=parseInt(r),s.appendChild(o))})}function toggleOption(e){var t=e.checked;e.value=t?1:0,console.log(t)}function nextPage(){let e=document.querySelector("section.active form"),t=e.querySelector("input[name='current_page']");var r=e.querySelector("input[name='tot_pages']").value,o=parseInt(t.value)+1;r<o||(t.value=o,r=e.querySelector("input[name='method']").value,o=e.querySelector("button.submit"),formSubmitXML(o,r))}function prevPage(){let e=document.querySelector("section.active form"),t=e.querySelector("input[name='current_page']");var r,o=parseInt(t.value)-1;o<1||(t.value=o,o=e.querySelector("input[name='method']").value,r=e.querySelector("button.submit"),formSubmitXML(r,o))}function showReportFilter(e,t){document.querySelectorAll(".reports-menu-item").forEach(function(e){e.classList.remove("active")}),t.classList.add("active");let r=document.getElementById(e);document.querySelectorAll("section.report-filter").forEach(function(e){e.classList.add("hidden"),e.classList.remove("active")}),cleanResults(),r.classList.remove("hidden"),r.classList.add("active")}function cleanResults(){let e=document.getElementById("reports_results_container"),t=(e.classList.add("hidden"),document.getElementById("reports_rooms_container")),r=(t.classList.add("hidden"),e.querySelector("#reports_results"));Array.from(r.querySelectorAll(".result")).forEach(function(e){e.remove()}),Array.from(t.querySelectorAll("ul .result")).forEach(function(e){e.remove()})}function reportCleanForm(e){e.querySelector("input[name='current_page']").value=1,e.querySelector("input[name='tot_pages']").value=0,e.querySelector("input[name='csv']").value=0}function reportFilterClick(e){reportCleanForm(e.form);var t=e.form.querySelector("input[name='method']").value;formSubmitXML(e,t)}function reportsCSV(){let e=document.querySelector("section.active form");e.querySelector("input[name='csv']").value=1;var t=e.querySelector("input[name='method']").value,r=e.querySelector("button.submit");formSubmitXML(r,t)}function convertToCSV(e){const t=[Object.keys(e[0])].concat(e);return t.map(function(e){return Object.values(e).map(function(e){return JSON.stringify(e).replace(/[^0-9a-zA-Z_", \-:;]/g,"")}).join(",")}).join("\n")}function downloadCSV(e){let t=document.createElement("a"),r=new Date,o=document.querySelector("section.active form");var l=o.querySelector("input[name='method']").value;r=r.toISOString().replace(/[^0-9]+/g,"").substring(0,12),t.href="data:attachment/text,"+encodeURI(e),t.target="_blank",t.download=r+"_"+l+"_export.csv";let s=document.createEvent("MouseEvents");s.initEvent("click",!0,!0),t.dispatchEvent(s)}
