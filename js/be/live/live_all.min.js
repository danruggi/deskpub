function callBackCalendarLiveUpdate(e){let t=0,i=getCookie("update_id");if(void 0!==i&&!isNaN(i)&&i.length>0&&(t=i),t==e.num);else if(console.log("Updating Live... (pastId: "+t+", newId: "+e.num+")"),setCookie("update_id",e.num,.01),0!=t&&null!=e.num){console.log("draw schema because updateId not zero");if(new Date().getTime()-lastDrawSchema<=5e3){console.log("Draw Schema Protection Time");return}drawSchema()}callBackCalendarNotifShowAll(e.notif),console.log("new msgs: "+e.msgs),1==e.msgs&&messageGetNewMessages(),e.hasOwnProperty("cleaning")&&callBackCleaning(e.cleaning)}function callBackCalendarNotifShowAll(e){notifRemoveAllElements(),count_toread=0,Array.from(Object.values(e)).forEach(function(e){console.log(e);let t=e[4],i=e[5],n=e[1],l=e[0],o=e[6],a=e[7],r=e[8],c=e[9],s=e[10],d="",u="";11==s&&(d="warning"),a>0?u="read":(count_toread++,u="toread"),null==n&&(n="System"),null==r&&(r=""),notifAddElement(t,i,n,r,d,u,l,s,o,c)}),notifSetNumber(count_toread),notifSetCursor()}function callBackCleaning(e){0!=map_settings.hotel.cleaning_mode&&(console.log(e),e.forEach(function(e){let t=e[0],i=e[1],n=e[2],l=stringFromSeconds(e[5]),o=stringFromSeconds(e[4]),a=stringFromSeconds(e[3]),r=e[8],c=map_rooms_names[t][2];if(0==c)document.querySelectorAll("[id^='b_"+t+"_']").forEach(function(e){e.classList.add("clean-"+n),0==n&&(e.title="Waiting cleaning (~"+a+")"),1==n&&(e.title=r+" is cleaning this room (~"+o+")"),5==n&&(e.title="Room Ready - by "+r+" (~"+l+" ago)")});else if(1==c){let s=document.querySelector("#b_"+t+"_"+i);s.classList.add("clean-"+n),0==n&&(s.title="Waiting cleaning (~"+a+")"),1==n&&(s.title=r+" is cleaning this room (~"+o+")"),5==n&&(s.title="Room Ready - by "+r+" (~"+l+" ago)")}}))}function headerUpdate(){updateCheckinsCheckouts();let e=new FormData;if(setNotifRead.length>0){let t=setNotifRead.join("_");e.append("notif_read",t),setNotifRead=[]}e.append("q","calendar_live_update_check"),postFetch(e)}function updateCheckinsCheckouts(){checkIns(),checkOuts()}function checkIns(){let e=new Intl.DateTimeFormat("en",{year:"numeric",year:"2-digit",month:"numeric",month:"2-digit",day:"2-digit"}),t=document.querySelector("header .checkin-number .check-numbers");if("object"!=typeof t)return;let[{value:i},,{value:n},,{value:l}]=e.formatToParts(todayG),o=l+"_"+i+"_"+n,a={},r=document.querySelectorAll("td[id^='"+o+"'")[1];if("object"!=typeof r)return;let[c,s]=getxy(r),d=c,u=0;Array.from(document.querySelectorAll("td[id^='"+o+"'")).forEach(function(e){if(!e.classList.contains("res"))return;let t=e.dataset.state;if(1==t||2==t||5==t){let i=!0,n=e.dataset.bid,l=e.dataset.cid,o=e.textContent,r;r=5==t?"done":"todo",Array.from(document.querySelectorAll("td.res")).forEach(function(e){if([c,s]=getxy(e),c>=d)return;let t=e.dataset.bid,o=e.dataset.cid;t==n&&o==l&&(i=!1)}),i&&(a.hasOwnProperty(n)?a[n][0]=parseInt(a[n][0])+1:(a[n]=[1,l,o,r],"todo"==r&&u++))}}),t.innerText=u,inOutHint(a,"checkin")}function inOutHint(e,t){let i="<div class='grid-container grid-2col' style='align-items: flex-start;'>",n="<ul class='checklist inout nodot p0 pl1 smaller'>",l="<ul class='checklist inout nodot p0 pl1 smaller'>",o;"checkin"==t?(o=document.querySelector("header .checkin-number .hint"),n+="<li class='header valid azul'><h4 class='m0'>Will Arrive Today</h4></li>",l+="<li class='header valid'><h4 class='m0'>Arrived Today</h4></li>"):"checkout"==t&&(o=document.querySelector("header .checkout-number .hint"),n+="<li class='header '><h4 class='m0'>Will Leave Today</h4></li>",l+="<li class='header valid'><h4 class='m0'>Left Today</h4></li>");let a="";if(0==Object.entries(e).length){o.classList.add("unvisible");return}o.classList.remove("unvisible"),Array.from(Object.entries(e)).forEach(function(e){let i=e[0],o=e[1][0];e[1][1];let r=e[1][2];"todo"==e[1][3]?(a="error ","checkin"==t&&(a+="azul "),n+="<a href='/workspace/booking.php?bid="+i+"'> ",n+="  <li class='grid-container grid-2col pl1 "+a+"'>",n+="    <span>"+r+"</span><span class='mr2'>"+o+" pax</span>",n+="  </li>",n+="</a>"):(a="valid",l+="<a href='/workspace/booking.php?bid="+i+"'> ",l+="  <li class='grid-container grid-2col pl1 "+a+"'>",l+="    <span>"+r+"</span><span class='mr2'>"+o+" pax</span>",l+="  </li>",l+="</a>")}),n+="</ul>",l+="</ul>",i=i+n+l,i+="</div>",o.innerHTML=i}function checkOuts(){let e=new Intl.DateTimeFormat("en",{year:"numeric",year:"2-digit",month:"numeric",month:"2-digit",day:"2-digit"}),t=new Date;t.setTime(todayG.getTime()-864e5);let i=document.querySelector("header .checkout-number .check-numbers");if("object"!=typeof i)return;let[{value:n},,{value:l},,{value:o}]=e.formatToParts(t),a=document.querySelectorAll("td[id^='"+(o+"_"+n)+"_"+l+"'")[1];if("object"!=typeof a)return;let[r,c]=getxy(a),s=r,d={},u=0;Array.from(document.querySelectorAll("td.res")).forEach(function(e){let t=!0,i=e.dataset.state;if(5==i||9==i){let n=e.dataset.bid,l=e.dataset.cid,o=e.textContent,a;5==i?a="todo":9==i&&(a="done");let r=e.dataset.xy.split("_")[0],f=e.getAttribute("colspan");parseInt(r)+parseInt(f)-1==s&&(Array.from(document.querySelectorAll("td.res")).forEach(function(e){if([r,c]=getxy(e),r<=s)return;let i=e.dataset.bid,o=e.dataset.cid;i==n&&o==l&&(t=!1)}),t&&(d.hasOwnProperty(n)?d[n][0]=parseInt(d[n][0])+1:(d[n]=[1,l,o,a],"todo"==a&&u++)))}}),i.innerText=u,inOutHint(d,"checkout")}var currentPanelContainer,notificationNotified=!1;function notifShow(e){let t=document.querySelector("#live_update_icon"),i=e.querySelector(".right-panel");if(0==notifGetNumber())return;t.classList.add("pointer"),currentPanelContainer=i.parentElement,i.parentElement.classList.add("active"),i.classList.remove("hidden"),i.style.maxHeight="none",i.style.maxWidth="none";let n=i.getBoundingClientRect().bottom,l=i.getBoundingClientRect().right,o=i.getBoundingClientRect().left,a=i.getBoundingClientRect().top,r=window.innerHeight,c=window.innerWidth;n>r&&(i.style.maxHeight=r-a-35+"px"),l>c&&(i.style.maxWidth=c-o-27+"px"),document.addEventListener("mousemove",notifEvent)}var toClose=!1;function notifClose(){document.querySelectorAll(".right-panel-container").forEach(function(e){let t=e.querySelector(".right-panel");null===t||t.classList.contains("hidden")||(t.classList.add("hidden"),e.classList.remove("active"),setTimeout(function(){headerUpdate()},1e3))}),document.removeEventListener("mousemove",notifEvent)}function notifEvent(e){e.target.id,currentPanelContainer.contains(e.target)?toClose=!1:(toClose=!0,setTimeout(function(){toClose&&notifClose()},400))}function notifRemoveAllElements(){let e=document.querySelector("#live_update_icon").querySelector("ul");for(;e.firstChild;)e.removeChild(e.firstChild)}function notifAddElement(e,t,i,n,l,o,a,r,c,s){iconurl="/assets/be/icons/","mail-toread"==l?iconurl+="mail-toread.svg":"warning"==l?iconurl+="alert-solid.svg":"toread"==o?iconurl+="mail-toread.svg":iconurl+="mail-ok.svg";let d=stringFromSeconds(c),u="",f="";"toread"==o&&(u="to-read"),n.length>2&&null!==n?f="onclick='headerUpdate(); window.location.replace(\""+n+"\")'":null!==s?f="onclick='"+s+";'":11==r&&(f='onclick=\'headerUpdate(); goSettings("b_settings_users", "b_settings_users_main_account")\'');let h=document.querySelector("#live_update_icon").querySelector("ul"),m="";m+="<li id='"+a+"' class='grid-container grid-14col "+u+"' onmouseover='notifSetRead(this)' "+f+">",m+="  <div class='img'><img src='"+iconurl+"' width='24' height='24'></div>",m+="  <div class='flex-container flex-col'>",m+="    <div class='title'><h5 class='m0'>"+e+"</h5></div>",m+="    <div class='message'><span>"+t+"</span></div>",m+="    <div class='grid-container grid-2col'>",m+="      <div class='user'><span>"+i+"</span></div>",m+="      <div class='time'>"+d+" ago</div>",m+="    </div>",m+="  </div>";let g=parseHTML(m+="</li>");h.insertBefore(g,h.firstChild)}function notifTest(e){rand=random(1,200),notifShow(e,"size")}function notifSetRead(e){if(setNotifRead.includes(e.id)||!e.classList.contains("to-read"))return;setNotifRead.push(e.id),e.classList.remove("to-read"),iconurl="/assets/be/icons/mail-ok.svg",e.querySelector("img").src=iconurl;let t=notifGetShownNumber();notifSetNumber(t-=1)}function notifGetNumber(){return Array.from(document.querySelectorAll("#live_update_icon .right-panel li")).length}function notifGetShownNumber(){return document.querySelector("#live_update_icon .notif-num span").innerText}function notifSetNumber(e){let t=document.querySelector("#live_update_icon").querySelector(".notif-num");span=t.querySelector("span"),0==e?(t.classList.add("hidden"),notificationNotified&&titleDecreaseNum(),notificationNotified=!1):(t.classList.remove("hidden"),notificationNotified||titleIncreaseNum(),span.innerText=e,notificationNotified=!0)}function notifSetCursor(){let e=document.querySelector("#live_update_icon");notifGetNumber()>0?e.classList.add("pointer"):e.classList.remove("pointer")}function notifLoad(){let e=new FormData;e.append("q","calendar_live_get_notifications"),postFetch(e)}