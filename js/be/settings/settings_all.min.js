const popup_form_code_back=document.getElementById("popup_form_code_back"),popup_form_code=document.querySelector("#popup_form_code"),popup_form_code_message=document.getElementById("form_code_message"),popup_form_code_digits=document.getElementById("form_code_digits");var popup_form_orig_input;function popupFormCodeShow(){document.querySelector("body").classList.add("noscroll"),popup_form_code_digits.querySelectorAll("input").forEach(function(e){e.addEventListener("input",popupFormCodeChanger),e.addEventListener("focus",popupFormClearThisInput)}),popup_form_code_back.classList.remove("hidden"),popup_form_code.classList.remove("hidden"),popupFormClearAllInputs(),popupFormEnableAllInputs()}function popupFormCodeHide(){document.querySelector("body").classList.remove("noscroll"),document.getElementById("form_code_send_again").classList.add("hidden"),popup_form_code.classList.add("hidden"),popup_form_code_digits.querySelectorAll("input").forEach(function(e){e.removeEventListener("input",popupFormCodeChanger),e.removeEventListener("focus",popupFormClearThisInput)}),popup_form_code_back.classList.add("hidden")}function popupFormClearThisInput(e){let t=e.target;t.value=""}function popupFormClearAllInputs(){for(let e=1;e<=6;e++)document.getElementById("form_code_"+e).value=""}function popupFormEnableAllInputs(e){for(let e=1;e<=6;e++)document.getElementById("form_code_"+e).disabled=!1;document.getElementById("form_code_1").focus()}function popupFormDisableAllInputs(e){for(let e=1;e<=6;e++)document.getElementById("form_code_"+e).disabled=!0}function popupFormShowMessage(e,t){"msg"==t?(popup_form_code_message.classList.add("tgreen"),popup_form_code_message.classList.remove("tred")):(popupFormDisableAllInputs(),popup_form_code_message.classList.remove("tgreen"),popup_form_code_message.classList.add("tred")),popup_form_code_message.innerText=e,popup_form_code_message.classList.remove("hidden"),setTimeout(function(){popupFormClearAllInputs(),popupFormEnableAllInputs(),popup_form_code_message.innerText="",popup_form_code_message.classList.add("hidden")},2e3)}function popupFormCodeChanger(e){let o=e.target;if(1==o.value.length)null!=o.nextElementSibling&&o.nextElementSibling.focus();else{if(6!=o.value.length)return void popupFormShowMessage("Code not valid","err");{let t=o.value;if(isNaN(t))return void popupFormShowMessage("Pasted code not valid",err);for(let e=0;e<6;e++){var n=e+1,s=t.slice(e,n);console.log(n+"--\x3e"+s),document.getElementById("form_code_"+n).value=s}}}let t="";for(let e=1;e<=6;e++)t+=document.getElementById("form_code_"+e).value.toString();e=document.getElementById("form_code_email").value;6==t.toString().length&&0<e.length&&(console.log("ok sending code: "+t),popupFormCodeCheck(t,e))}function popupFormCodeNew(e){let t,o,n=!1;"form_code_send_again"==e.id?(t=document.getElementById("form_code_email"),o=t.value,n=!0):(t=e.form.querySelector('input[name="email"]'),o=t.value),e.classList.add("loading"),str="q=newcode&email="+o,fetch("/register/emailVerifyCode.php?"+str).then(e=>e.json()).then(e=>{if(document.querySelectorAll("button.loading").forEach(function(e){e.classList.remove("loading")}),document.getElementById("form_code_loader").classList.add("hidden"),console.log(e),e.hasOwnProperty("e"))n?popupFormShowMessage(e.m,"err"):showMessage(!1,e.m);else{if(n)popupFormShowMessage(e.m,"msg");else if(document.querySelector("#form_code_email").value=o,"verification_needed"==e.d)popupFormCodeShow();else if("verification_jump"==e.d)return void(location.href="/register/hotelreg");console.log("new code created email sent")}}).catch(e=>{document.querySelectorAll("button.loading").forEach(function(e){e.classList.remove("loading")}),document.getElementById("form_code_loader").classList.add("hidden"),n?popupFormShowMessage(e,"err"):showMessage(!1,e)})}function popupFormCodeCheck(e,t){document.getElementById("form_code_loader").classList.remove("hidden"),popupFormDisableAllInputs(),str="q=checkcode&email="+t+"&code="+e,fetch("/register/emailVerifyCode.php?"+str).then(e=>e.json()).then(e=>{document.getElementById("form_code_loader").classList.add("hidden"),e.hasOwnProperty("e")?(popupFormShowMessage(e.m,"err"),document.getElementById("form_code_send_again").classList.remove("hidden")):(popupFormCodeHide(),console.log("Code Valid"),showMessage("True",e.m),location.reload())}).catch(e=>{popupFormShowMessage(e,"err")})}function popupFormCodeNewResend(e){e.classList.add("hidden"),document.getElementById("form_code_loader").classList.remove("hidden"),popupFormCodeNew(e)}function showRooms(e){let t="",o,n,s,i,l,r,a="",c=document.getElementById("room_list");Array.from(c.querySelectorAll(".room")).forEach(function(e){e.remove()}),Object.entries(e).forEach(function(e){[s,o,l,a,n,i,r]=mapRoom(e);e=roomsCatImg(r);t=(t=(t=(t=(t=(t=(t+="<li id='"+s+"' class='grid-container no-gap room'  style='grid-template-columns: 3fr 2fr 1fr 1fr 1fr 1fr;'>")+"\t<h4 class='m0'>"+n+"</h4>\t<div class='flex-container flex-col'>")+"\t\t<span class='m0'><b>"+rooms_types[i]+"</b></span>")+"\t\t<span class='m0'>"+rooms_categories[r]+"</span>")+"\t</div>\t<img src='/assets/be/icons/"+e+"' class='m0a filter-gray' width='16' height='16' >")+"\t<span>"+o+"</span>\t<div class='flex-container flex-col'>")+"\t\t<span class=''>"+l+" "+curr+"</span>",0<a&&(t+="\t\t<span class='smaller'><i>"+a+" "+curr+"</i></span>"),t=(t=(t=(t+="\t</div>\t<div class='flex-container centered'> ")+"\t\t<img class='edit-icon' src='/assets/be/icons/user-edit-solid.svg' height='20' alt='"+s+"' onclick='editRoom(this.attributes.alt.value)' width='20'>")+"\t\t<img class='delete-icon filter-red' src='/assets/be/icons/times-solid.svg' alt='"+s+"' onclick='deleteRoom(this.attributes.alt.value)' height='20' width='20'>")+"\t</div></li>"}),t.length,c.innerHTML+=t}function showBottomRoomInfos(e){let t=getParentByClass(e,"season"),o=t.querySelector(".room-info");o.classList.toggle("hidden")}function showFormToEditRoom(e){let t,o,n,s,i,l="",r=(document.getElementById("popout_dark_back").hidden=0,document.getElementById("popup_edit_room")),a=r.querySelector("form");r.hidden=0,a.hidden=0,a.querySelectorAll("input").forEach(function(e){e.value=""}),console.log(e),Object.entries(e).forEach(function(e){console.log(e),[n,t,i,l,o,s,cat]=mapRoom(e)}),a.querySelector("input[name=rname]").value=o,a.querySelector("input[name=rprice]").value=i,a.querySelector("input[name=rweprice]").value=l,a.querySelector("input[name=rid]").value=n,a.querySelector("select[name=rtype]").value=s,a.querySelector("select[name=rpax]").value=t,a.querySelector("select[name=rcat]").value=cat}function showFormToEditRoom(e){let t,o,n,s,i,l="",r=(document.getElementById("popout_dark_back").hidden=0,document.getElementById("popup_edit_room")),a=r.querySelector("form");r.hidden=0,a.hidden=0,a.querySelectorAll("input").forEach(function(e){e.value=""}),console.log(e),Object.entries(e).forEach(function(e){console.log(e),[n,t,i,l,o,s,cat]=mapRoom(e)}),a.querySelector("input[name=rname]").value=o,a.querySelector("input[name=rprice]").value=i,a.querySelector("input[name=rweprice]").value=l,a.querySelector("input[name=rid]").value=n,a.querySelector("select[name=rtype]").value=s,a.querySelector("select[name=rpax]").value=t,a.querySelector("select[name=rcat]").value=cat}function mapRoom(e){return rid=e[0],pax=e[1][4],price=e[1][3],weprice=e[1][7],name=e[1][2],type=e[1][1],cat=e[1][5],[rid,pax,price,weprice,name,type,cat]}function showUsers(e){let n="",s,i,l,r,a,c,d,u,p,m,g,f,h,_="",t=document.getElementById("users_list");Array.from(t.querySelectorAll(".users")).forEach(function(e){e.remove()}),Object.entries(e).forEach(function(e){[s,i,l,r,a,c,d,u,p,m,g,f,h,_]=mapUser(e);let t="";0!=g&&2==f||(t="tlgray"),l<10&&(l=10),null==m&&(m="-");e=usersCatImg(l);let o="checked";0==g&&(o=""),n=(n=(n=(n=(n+="<li id='"+s+"' class='grid-container no-gap users ta-c keep-sizes "+t+"'  style='grid-template-columns: 1fr 1fr 2fr 1fr 1fr 1fr 1fr 1fr;'>")+"\t<h4 class='m0 ta-l'>"+i+"</h4>\t<div class='flex-centered ta-c'>")+"\t\t<span><b>"+_+"</b></span>\t\t<img src='/assets/be/icons/"+e+"' class='filter-gray m0a' width='16' height='16' >")+"\t</div>\t<div class='flex-centered ta-c'>")+"\t\t<span class='m0' style='overflow:hidden'>"+r+"</span>",2!=f&&(172800<h?n+="<a href='#_' class='smaller tred' onClick='sendEmailVerificationUser("+s+")'>Verification Expired. Send new mail.</a>":n+="<a href='#_' class='smaller tred' onClick='sendEmailVerificationUser("+s+")'>Not Verified. Send new mail.</a>"),n+="\t</div>\t<div class='flex-container m0a'>",0<d&&(n+="<img alt='icon' src='/assets/be/icons/google.svg' class='filter-g m2p' width='16' height='16'>"),0<c&&(n+="<img alt='icon' src='/assets/be/icons/facebook1.svg' class='filter-fb m2p' width='16' height='16'>"),0<u&&(n+="<img alt='icon' src='/assets/be/icons/lock-solid.svg' class='filter-yellow m2p' width='16' height='16'>"),n=(n=(n+="\t</div>")+"\t\t<span>"+p+"</span>")+"\t\t<span>"+m+"</span>\t<div class='flex-container centered'> ",n=(n=l<100&&70<=level?(n+="<img class='edit-icon m2p' src='/assets/be/icons/user-edit-solid.svg' height='20' alt='"+s+"' onclick='editUser(this.attributes.alt.value)' width='20'>")+"<img class='delete-icon filter-red m2p' src='/assets/be/icons/times-solid.svg' alt='"+s+"' onclick='deleteUser(this.attributes.alt.value)' height='20' width='20'>":n)+"\t</div>\t<div class='flex-container centered'> ",l<100&&s!=uid&&70<=level&&(n+="<div class='switch flex-centered small'> <input type='checkbox' id='toggleUserActive_"+s+"' "+o+" alt='"+s+"' onclick='toggleUser(this); return;'> <label for='toggleUserActive_"+s+"'></label> </div>"),n+="\t</div></li>"}),n.length,t.innerHTML+=n}function showFormToEditUser(e){let t,o,n,s,i,l,r,a,c,d,u="",p=(document.getElementById("popout_dark_back").hidden=0,document.getElementById("popup_staff")),m=p.querySelector("form");p.hidden=0,m.hidden=0,m.querySelectorAll("input").forEach(function(e){e.value=""}),console.log(e),Object.entries(e).forEach(function(e){[t,o,n,s,i,l,r,a,c,d,u,verificationState]=mapUser(e)}),m.querySelector("input[name=user_name]").value=o,m.querySelector("input[name=uid]").value=t,m.querySelector("select[name=user_role]").value=n,m.querySelector("input[name=user_email]").value=s,m.querySelector("input[name=user_username]").value=i}function mapUser(e){return[e[0],e[1][0][1],e[1][0][2],e[1][0][3],e[1][0][4],e[1][0][5],e[1][0][6],e[1][0][7],e[1][0][8],e[1][0][9],e[1][0][10],e[1][0][11],e[1][0][12],e[1][0][13]]}function showSeasons(e){let t="",o,n,s,i,l,r,a,c=document.getElementById("seasons_list");Array.from(c.querySelectorAll(".season")).forEach(function(e){e.remove()}),Object.entries(e).forEach(function(e){console.log(e),[o,s,i,n,recurrent]=mapSeason(e),t=(t=(t=(t=(t=(t=(t=(t=(t=t+("<li id='"+o)+"' class='flex-container flex-col season'>\t<div class='grid-container no-gap m0' style='grid-template-columns: 3fr 2fr 2fr 1fr 1fr;'>")+"\t\t<h4 class='m0 pointer' onclick='showBottomRoomInfos(this)'><b>"+n+"</b></h4>")+"\t\t<span>"+s+"</span>")+"\t\t<span>"+i+"</span>")+"\t\t<span>"+recurrent+"</span>\t\t<div class='flex-container centered'> ")+"\t\t\t<img class='edit-icon' src='/assets/be/icons/user-edit-solid.svg' height='20' alt='"+o+"' onclick='editSeason(this.attributes.alt.value)' width='20'>")+"\t\t\t<img class='delete-icon filter-red' src='/assets/be/icons/times-solid.svg' alt='"+o+"' onclick='deleteSeason(this.attributes.alt.value)' height='20' width='20'>")+"\t\t</div>\t</div>")+"\t<div class='room-info blgray grid-container grid-3col m0a no-gap hidden w60' style='padding:1em; border-radius: 1em;'>\t\t<h4 class='m0'>Room Name</h4><h4 class='m0'>Normal Price</h4><h4 class='m0'>Season Price</h4>",Object.entries(e[1]).forEach(function(e){console.log(e),l=e[1][9],r=e[1][8],a=e[1][7],t=(t=(t+="\t\t<h5 class='m0'><b>"+l+"</b></h5>")+"\t\t<span>"+r+" "+curr+"</span>")+"\t\t<span><b>"+a+" "+curr+"</b></span>"}),t+="\t</div></li>"}),c.innerHTML+=t}function showFormToEditSeason(e){let t,o,n,s,i,l,r,a,c=(showPopup("popup_season_edit"),document.getElementById("popup_season_edit")),d=c.querySelector("form");d.querySelectorAll("input").forEach(function(e){e.value=""}),console.log(e);var e=Object.entries(e)[0],u=(console.log(e),[t,n,s,o,recurrent]=mapSeason(e),console.log(o),d.querySelector("input[name='sname']").value=o,d.querySelector("input[name=sid]").value=t,console.log(n),console.log(s),new Date(n+"T00:00:00.000Z")),p=new Date(s+"T00:00:00.000Z");initDeskyCalendar("edit_season_sd","single",u,null,"edit_season_ed",null,null,!0),initDeskyCalendar("edit_season_ed","single",p,null,null,u,null,!0),Object.entries(e[1]).forEach(function(e){l=e[1][9],r=e[1][8],a=e[1][7],i=e[1][6],d.querySelector("input[name='"+i+"']").value=a})}function mapSeason(e){return sid=e[0],sd=e[1][0][3],ed=e[1][0][4],recurrent=e[1][0][5],name=e[1][0][1],[sid,sd,ed,name,recurrent]}function editSiblingBeforeCallBack(e,t){if(!t.hasOwnProperty("d"))return!1;let o=document.getElementById(e);cancelSiblingBefore(o.parentElement.querySelector("form")),console.log(t.d),o.querySelector("span").innerText=t.d}function makeSelectFromParsed(e,t){let o="",n=document.getElementById(t),s="",i=("location_settings"==t&&(s=document.getElementById("select_countries_list"),e.forEach(function(e){o+="<option value='"+e.alpha2Code+"'>"+e.name+"</option>"})),s.innerHTML=o,n.querySelector(".content")),l=n.querySelector("form");i.classList.add("hidden"),l.classList.remove("hidden")}function showCurrencies(e){let t="";Object.values(e).forEach(function(e){if(3!=e[0].length)return!1;t=(t+="<div class='tag flex-container space-between'>")+"\t<span class='smaller'>"+e[0]+"</span><div class='flex-centered'><img src='/assets/be/icons/times-solid.svg' onclick='deletePrevSiblingExtraCurrency(this)' width='12' height='12'></div></div>"}),document.getElementById("currencies_list").lastElementChild.innerHTML=t}function showExtrasServices(e){let t="",o=document.getElementById("extras_list"),n=o.querySelector("ul");Array.from(o.querySelectorAll(".xtra")).forEach(function(e){e.remove()}),Object.values(e).forEach(function(e){console.log(e),t=(t=(t=(t+="\t<li class='grid-container grid-411col mb1 xtra'>")+"\t\t<div>"+e[1]+"</div>")+"\t\t<div>"+e[2]+"</div>")+"\t\t<img src='/assets/be/icons/times-solid.svg' onclick='deleteExtraService("+e[0]+")' class='filter-red pointer' width='12' height='12'>\t</li>"}),n.innerHTML+=t}function showReturnableDeposits(e){let t="",o=document.getElementById("deposits_list"),n=o.querySelector("ul");Array.from(o.querySelectorAll(".xtra")).forEach(function(e){e.remove()}),Object.values(e).forEach(function(e){console.log(e),t=(t=(t=(t+="\t<li class='grid-container grid-411col mb1 xtra'>")+"\t\t<div>"+e[1]+"</div>")+"\t\t<div>"+e[2]+"</div>")+"\t\t<img src='/assets/be/icons/times-solid.svg' onclick='deleteReturnableDeposit("+e[0]+")' class='filter-red pointer' width='12' height='12'>\t</li>"}),n.innerHTML+=t}function showTaxes(e){let t="",o=document.getElementById("taxes_list"),n=o.querySelector("ul");Array.from(o.querySelectorAll(".xtra")).forEach(function(e){e.remove()}),Object.values(e).forEach(function(e){console.log(e),t=(t=(t=(t+="\t<li class='grid-container grid-3col mb1 xtra'>")+"\t\t<div>"+e[1]+"</div>")+"\t\t<div class='bold'>"+e[2]+" <span class='smaller'>%</span></div>")+"\t\t<img src='/assets/be/icons/times-solid.svg' onclick='deleteTax("+e[0]+")' class='filter-red pointer' width='12' height='12'>\t</li>"}),n.innerHTML+=t}function showPaymentMethods(e){let t="",o=document.getElementById("payment_methods_list"),n=o.querySelector("ul");Array.from(o.querySelectorAll(".xtra")).forEach(function(e){e.remove()}),Object.values(e).forEach(function(e){console.log(e),t=(t+="\t<li class='grid-container grid-411col mb1 xtra'>")+"\t\t<div>"+e[1]+"</div>\t\t<div class='flex-centered'>",1==e[2]?t+="<img src='/assets/be/icons/check-solid.svg' class='filter-green m0a' width='20' height='20'>":t+="<a href='#' onclick='setPaymentMethodAsDefault("+e[0]+");' style='font-size:0.6em;'>Set Default</a>",t=(t+="\t\t</div>")+"\t\t<img src='/assets/be/icons/times-solid.svg' onclick='deletePaymentMethod("+e[0]+")' class='filter-red pointer' width='12' height='12'>\t</li>"}),n.innerHTML+=t}function stripeProcess(t){if(spin.hidden=1,spin_msg.hidden=1,console.log(t),t.hasOwnProperty("q")){var n=t.q;if("settings_users_bills_stripe_card_save"==n)showMessage(!0,"Card saved as default payment method");else{stripeHideAllSections();var e=t.user.stripe_user_id,s=t.user.state;let o=t.user.ed_actual_subscription;var i=t.user.stripe_subscription_id,l=t.user.stripe_payment_intent_client_secret;if(1==s){if("settings_users_bills_user_payment_intent_confirm"==n){let e=document.getElementById("stripe_subscription_payment_ok");return e.classList.remove("hidden"),void setTimeout(function(){goSettings("b_settings_users","b_settings_users_bills")},500)}let i=document.getElementById("stripe_subscription_is_active");if(i.classList.remove("hidden"),null==o){i.querySelector(".subEd").innerText="Updating...";let e=new FormData;e.append("q","settings_users_bills_stripe_subscription_update_local"),postFetch(e)}else{let e=o.split(/[- :]/),t=(e[1]--,new Date(Date.UTC(...e)));if(i.querySelector(".subEd").innerText=t.toLocaleString(),"settings_users_bills_stripe_subscription_update_local"==n)return}let l="";if(null!=t.payments){for(i=document.querySelector(".sub-payments ul");i.firstChild;)i.removeChild(i.firstChild);let e=0;Array.from(Object.values(t.payments)).forEach(function(s){if(!(4<=++e)){console.log(s);let e=s.insert_date.split(/[- :]/),t=(e[1]--,new Date(Date.UTC(...e))),o="done",n=(0==s.status&&(o="error"),"manual");1==s.automatic&&(n="cyclic"),l="<li id="+s.stripe_pi_id+' class="grid-container grid-4col">',l=(l=(l=(l+="\t<span>"+t.toLocaleString()+"</span>")+("\t<span>"+o+"</span>"))+("\t<span>"+n+"</span>"))+('\t<h3 class="ta-r m0"><b>'+s.amount+" USD</b></h3>")+"</li>";s=parseHTML(l);i.appendChild(s)}})}if(null!=t.cards){for(i=document.querySelector(".sub-cards ul");i.firstChild;)i.removeChild(i.firstChild);Array.from(Object.values(t.cards)).forEach(function(e){console.log(e);var t=e.expire.substr(0,7).replace("-","/");l=(l=(l=(l=(l=(l=(l="<li id="+e.stripe_pm_id+' class="grid-container stripe-card grid-2col noarrow" style="line-height: 2em">')+'\t<div class="flex-container">\t\t<span class="tag ta-c twhite flex-centered mr1 smaller" style="background-color: #000074; width: fit-content; min-width: 25px; height: 25px">')+"\t\t\t<b>"+e.brand.toUpperCase()+"</b>")+'\t\t</span>\t\t<span class="small ta-r  flex-centered" style="line-height: 1.3em">')+'\t\t\t<span><span class="mr1 tgray">'+e.brand.toUpperCase()+"</span> *** "+e.last4+"</span>")+'\t\t\t<span class="tlgray">Expire: '+t+"</span>\t\t</span>")+"\t</div></li>",parseHTML(l)})}}else if(8==s){let e=document.getElementById("stripe_subscription_cancel_at_period_end"),t=(e.classList.remove("hidden"),new Date(o+" UTC"));e.querySelector(".subEd").innerText=t.toLocaleString()}else if(null!=i)console.log(">>> STEP 2: has stripe id, has subscription, no payment. From Request --\x3e "+n),document.querySelector("#stripe_collect_payment").classList.remove("hidden"),document.querySelector("#stripe_client_secret").value=l,document.querySelector("#stripe_subscription_id").value=i,initStripeCardForm();else if(null==e||e.length<2){console.log(">>> STEP 0: no stripe id "),console.log(">>> STEP 0: Creating user on stripe..."),spin.hidden=0,spin_msg.hidden=0;let e=new FormData;e.append("q","settings_users_bills_stripe_subscription_create"),postFetch(e)}else{console.log(">>> STEP 8-0: No Subscription, but stripe id "),console.log(">>> STEP 8-0: Subscription was canceled, create a new one"),spin.hidden=0,spin_msg.hidden=0;let e=new FormData;e.append("q","settings_users_bills_stripe_subscription_create"),postFetch(e)}}}else showMessage(!1,"Bad formatted response")}function stripeHideAllSections(){document.querySelectorAll("section").forEach(function(e){e.classList.add("hidden")})}function hideAllSubMenus(){Array.from(document.querySelectorAll(".sub-top-bar")).forEach(function(e){e.classList.add("hidden")})}function hideAllSections(){Array.from(document.querySelectorAll(".section")).forEach(function(e){e.classList.add("hidden")})}function setActive(e){Array.from(e.parentElement.children).forEach(function(e){e.classList.remove("active")}),e.classList.add("active")}function disableAllButtons(){Array.from(document.querySelectorAll(".config-tile")).forEach(function(e){e.classList.add("disabled")})}function enableAllButtons(){Array.from(document.querySelectorAll(".config-tile")).forEach(function(e){e.classList.remove("disabled")})}function enableAButton(e){document.getElementById(e).classList.remove("disabled")}function clickAButton(e,t=!1){let o=document.getElementById(e);Boolean(t)&&o.classList.contains("disabled")&&enableAButton(e),document.getElementById(e).click()}function menuClick(o){let n=o.target;if(!n.classList.contains("disabled")){let e=0;for(;!(n.classList.contains("config-tile")||(n=n.parentElement,3<++e)););checkSyncRoomsReload(),n.classList.contains("right-tile")&&cleanJsonUlLists();let t=n.id;if("b_logout"==t)location.href="/register/logout.php";else{"b_settings_property_rooms"==t?loadRooms():"b_settings_property_extra"==t?loadExtraServices():"b_settings_property_payment_methods"==t?loadPaymentMethods():"b_settings_seasons_main"==t?loadSeasons():"b_settings_property_deposits"==t?loadReturnableDeposits():"b_settings_property_taxes"==t?loadTaxes():"b_settings_users_staff"==t?loadUsers():"b_settings_users_bills"==t&&loadBills();o=t.substr(2);setActive(n),hideAllSections();let e=document.getElementById(o);e&&(n.classList.contains("left-tile")?(setCookie("menu1",t,.003),hideAllSubMenus(),e.classList.remove("hidden"),document.getElementById(o).firstElementChild.click()):(setCookie("menu2",t,.003),document.getElementById(t).classList.remove("hidden"),e.classList.remove("hidden")))}}}function propertyChange(e){e=e.value;e!=hid&&(console.log("Trying switch to property: "+e),location.href="/workspace/switch.php?p="+e)}function checkSyncRoomsReload(){var e=Array.from(document.getElementById("room_list").querySelectorAll("li.room")).length;e!=document.getElementById("conf_rooms_by_db").innerText&&0<e&&location.reload()}function loadRooms(){postHttpReq("settings_room_show")}function deleteRoom(e){console.log(e),out=[e],postHttpReq("settings_room_delete",out)}function editRoom(e){console.log(e),out=[e],postHttpReq("settings_room_edit",out)}function setRoomsImages(){let e=document.getElementById("popup_season_add");Array.from(e.querySelectorAll(".rcat")).forEach(function(e){var t=e.attributes.alt.value,t=roomsCatImg(t);e.attributes.src.value="/assets/be/icons/"+t,e.hidden=0})}function loadCurrencies(){postHttpReq("settings_show_currencies")}function deletePrevSiblingExtraCurrency(e){e=e.parentElement.previousElementSibling.innerText;postHttpReq("settings_delete_extra_currency",e)}function loadPaymentMethods(){postHttpReq("settings_payment_method_get")}function deletePaymentMethod(e){console.log("delete x "+e),out=[e],postHttpReq("settings_payment_method_delete",out)}function setPaymentMethodAsDefault(e){console.log("defualt "+e),out=[e],postHttpReq("settings_payment_method_default",out)}function loadExtraServices(){postHttpReq("settings_extra_show")}function deleteExtraService(e){console.log("delete x "+e),out=[e],postHttpReq("settings_extra_delete",out)}function loadReturnableDeposits(){postHttpReq("settings_deposits_show")}function deleteReturnableDeposit(e){console.log("delete x "+e),out=[e],postHttpReq("settings_deposit_delete",out)}function loadTaxes(){postHttpReq("settings_tax_show")}function deleteTax(e){console.log("delete x "+e),out=[e],postHttpReq("settings_tax_delete",out)}function loadSeasons(){postHttpReq("settings_season_show")}function editSeason(e){console.log(e),out=[e],postHttpReq("settings_season_edit",out)}function deleteSeason(e){console.log(e),out=[e],postHttpReq("settings_season_delete",out)}function passwordChange(){document.getElementById("user_password_action").value="change_password",document.getElementById("user_current_password_container").classList.remove("hidden"),showPopup("popup_password")}function passwordSet(){document.getElementById("user_password_action").value="new_password",document.getElementById("user_current_password_container").classList.add("hidden"),showPopup("popup_password")}function loadUsers(){postHttpReq("settings_users_show",[])}function editUser(e){console.log(e),out=[e],postHttpReq("settings_user_edit",out)}function deleteUser(e){console.log(e),out=[e],postHttpReq("settings_user_delete",out)}function toggleUser(e){var t=e.attributes.alt.value,e=e.checked,t=(console.log(t+" -- "+e),["&uid="+t+"&checked="+e]);postHttpReq("settings_user_toggle",t)}function sendEmailVerificationUser(e){console.log(e),out=[e],postHttpReq("settings_user_email_reverify",out)}function loadBills(){if(108==level)document.getElementById("still_free_beta_test").classList.remove("hidden");else if(120<=level&&level<150&&0<subscriptionMissingSeconds)document.getElementById("still_free_tier_subscription").classList.remove("hidden");else{spin.hidden=0,spin_msg.hidden=0;let e=new FormData;e.append("q","settings_users_bills_user_get"),postFetch(e)}}function stripeDeleteCard(e){e=getParentByType(e,"LI");console.log("delete card "+e.id);let t=new FormData;t.append("q","settings_users_bills_stripe_card_delete"),t.append("card",e.id),confirm("Deleting card, automatic payments will be disabled. Are you sure?")&&postFetch(t)}function stripeCancelSubscription(){let e=new FormData;e.append("q","settings_users_bills_stripe_subscription_cancel"),confirm("Subscription will be valid till End Date, but no more charges will be applied. Are you sure?")&&postFetch(e)}function showFormBottom(e){let t=e.form,o=t.nextElementSibling;t.hidden=1,o.hidden=0}function hideFormBottom(e){let t=e.form,o=t.previousElementSibling;t.hidden=1,o.hidden=0}function editSiblingBefore(e){var t=e.previousElementSibling,o=t.attributes.alt.value,n=t.firstElementChild.innerText,t=t.lastElementChild.innerText;console.log(n+"--"+t);let s=e.parentElement;if(0<s.getElementsByTagName("form").length)return!1;s.children.forEach(function(e){e.hidden=1});o=createEditForm(o,t,n);e.parentElement.innerHTML+=o}function cancelSiblingBefore(e){let t=e.parentElement;t.children.forEach(function(e){e.hidden=0}),e.remove()}function createEditForm(e,t,o){let n,s="";return s+("<form class='flex-container centered editSiblingBefore' alt='"+(n="hname"==e?"settings_update_hotel_name":n)+"'>")+("\t<label for='id_"+e+"' class='hidden'>Name: </label>")+("\t<input id='id_"+e+"' name='"+e+"' placeholder='"+o+"' class='shadow dgreen mandatory mr2' value='"+t+"'>")+"\t<button class='transparent p0' type='button' onclick='editSiblingBeforePrepareSubmit(this)'>"+"\t\t<img src='/assets/be/icons/check-solid.svg' class='filter-green'  width='20' height='20'>"+"\t</button>"+"\t<button class='transparent p0 cancel' type='button' onclick='cancelSiblingBefore(this.form)'>"+"\t\t<img src='/assets/be/icons/times-solid.svg' class='filter-red'  width='20' height='20'>"+"\t</button>"+"</form>"}function editSiblingBeforePrepareSubmit(e){var t=e.form.attributes.alt.value;formSubmitXML(e,t)}function geoFindMe(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t=e.coords.latitude;reverseGeocodingWithGoogle(e.coords.longitude,t)},function(){console.log("Unable to retrieve your location")}):console.log("Geolocation is not supported by your browser")}function reverseGeocodingWithGoogle(e,t){fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${e},${t}&key={GOOGLE_MAP_KEY}`).then(e=>e.json()).then(e=>{console.log("User's Location Info: ",e)}).catch(e=>{console.log("Request failed.  Returned status of",e)})}function geocodingWithGoogle(e,o){if(o.value.length<3)return!1;let i="";fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${o.value}&key=AIzaSyBjsw41QanLXuD36cKvfe7r54WciCTDTKg`).then(e=>e.json()).then(e=>{let n=document.getElementById("results_query_maps"),s=countryCode=region=city=locality=sublocality=route=t=src="";for(;n.firstChild;)n.removeChild(n.firstChild);Array.from(e.results).forEach(function(e){console.log(e);let t=!1;var o="",e=(0<=Object.values(e.types).indexOf("lodging")?(src="/assets/be/icons/hotel.svg",t=!0):src="/assets/be/icons/map-marker-alt-solid.svg",t&&(i=e.place_id),e.address_components.forEach(function(t){t.types.forEach(function(e){"country"==e?(s=t.long_name,countryCode=t.short_name):"administrative_area_level_1"==e?region=t.long_name:"locality"==e?locality=t.long_name:"sublocality_level_1"==e?sublocality=t.long_name:"route"==e&&(route=t.long_name)})}),o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=o+"<li onclick='getGoogleResultsAndSetForm(this)'>"+"\t<div class='flex-container flex-col'>")+"\t\t<div class='grid-container grid-1col country-infos ta-c' style='grid-auto-rows: 1fr'>"+"\t\t\t<div class='flex-centered'>")+"\t\t\t\t<div class='flex-container'>"+"\t\t\t\t\t<div class='flex-centered'>")+("\t\t\t\t\t\t<img src='"+src+"' class='filter-red m1' width='24' height='24'>"))+("\t\t\t\t\t\t<span class='hidden' alt='place_id'>"+i+"</span>"))+"\t\t\t\t\t</div>"+"\t\t\t\t\t<div class='flex-centered m1'>")+("\t\t\t\t\t\t<span alt='hroute'><b>"+route+"</b></span>"))+("\t\t\t\t\t\t<span alt='hsubloc' class='smaller'><i>"+sublocality+"</i></span>"))+"\t\t\t\t\t</div>"+"\t\t\t\t\t<div class='flex-centered m1'>")+("\t\t\t\t\t\t<span alt='hcity'>"+locality+"</span>"))+("\t\t\t\t\t\t<span alt='hregion' class='smaller'>"+region+"</span>"))+"\t\t\t\t\t</div>"+"\t\t\t\t\t<div class='flex-centered m1'>")+("\t\t\t\t\t\t<span alt='hcountry' class='bigger'>"+s+" <span alt='hccode'>("+countryCode+")</span></span>"))+"\t\t\t\t\t</div>"+"\t\t\t\t</div> ")+"\t\t\t</div> "+"\t\t</div>")+"\t</div>"+"</li>",parseHTML(o));n.append(e)}),n.parentElement.classList.remove("hidden"),document.addEventListener("click",hideGoogleSearchResult)}).catch(e=>{console.log("Request failed.  Returned status of",e)})}function getGoogleResultsAndSetForm(e){let t=document.getElementById("results_query_maps"),o=document.getElementById("settings_update_location"),n=o.querySelector("form");n.querySelector("input[name=hcountry]").value=e.querySelector("span[alt=hcountry]").innerText,n.querySelector("input[name=hccode]").value=e.querySelector("span[alt=hccode]").innerText,n.querySelector("input[name=hregion]").value=e.querySelector("span[alt=hregion]").innerText,n.querySelector("input[name=hcity]").value=e.querySelector("span[alt=hcity]").innerText,n.querySelector("input[name=hroute]").value=e.querySelector("span[alt=hroute]").innerText,n.querySelector("input[name=hroute]").value+=" "+e.querySelector("span[alt=hsubloc]").innerText,n.querySelector("input[name=place_id]").value=e.querySelector("span[alt=place_id]").innerText,(t=document.querySelector("#google_map_search")).value=n.querySelector("input[name=hroute]").value+", "+e.querySelector("span[alt=hcity]").innerText+", "+e.querySelector("span[alt=hcountry]").innerText}function hideGoogleSearchResult(){let e=document.getElementById("query_maps_search_result");e.classList.contains("hidden")||(e.classList.toggle("hidden"),console.log("closed"),document.removeEventListener("mousedown",hideGoogleSearchResult))}function editSettingCard(e,t){let o=document.getElementById(t),n=o.querySelector(".content"),s=o.querySelector("form");n.classList.add("hidden"),s.classList.remove("hidden")}function closeEditSettingCard(e,t){let o=document.getElementById(t),n=o.querySelector(".content"),s=o.querySelector("form");n.classList.remove("hidden"),s.classList.add("hidden")}function setAllCurrenciesSelect(n){document.querySelectorAll("select[name=currency]").forEach(function(e){for(var t,o=0;t=e.options[o];o++)if(t.value==n){e.selectedIndex=o;break}})}function percentCurrencyChanger(e){e=e.value;let t="";t=0==e?curr:"%",document.getElementById("percent_curr_symbol").innerText=t}function settingsToggleOption(e){var t=e.id,o=e.checked,e=e.dataset.method;let n,s=(n=o?1:0,new FormData);s.append("opt",t),s.append("val",n),s.append("q",e),postFetch(s)}function cleanJsonUlLists(){document.querySelectorAll(".json-ul-list").forEach(function(e){e.querySelectorAll("li").forEach(function(e){e.classList.contains("header")||e.remove()})})}function initStripeCardForm(){null===stripeElements.getElement("card")&&(spin.hidden=0,spin_msg.hidden=0,(cardElement=stripeElements.create("card",{style:{base:{color:"#666",fontWeight:"500",fontFamily:"Roboto",fontSize:"16px",fontSmoothing:"antialiased",":-webkit-autofill":{color:"#998000"},"::placeholder":{color:"#87BBFD"}}},hidePostalCode:!0})).mount("#card-element"),cardElement.on("change",function(e){displayError(e)}),spin.hidden=1,spin_msg.hidden=1)}function displayError(e){let t=document.getElementById("card-element-errors");e.error?t.textContent=e.error.message:t.textContent=""}function confirmPayment(e){let s=e.form;if(!checkMandatory(s))return!1;if(!s.querySelector("#accept_privacy_policy").checked)return showMessage(!1,"You need to accept the privacy policy"),!1;spin.hidden=0,spin_msg.hidden=0;var e=stripeElements.getElement("card"),t=document.getElementById("stripe_payment_name").value,o=document.getElementById("stripe_client_secret").value;stripe.confirmCardPayment(o,{payment_method:{card:e,billing_details:{name:t}}}).then(o=>{if(console.log(o),spin.hidden=1,spin_msg.hidden=1,displayError(o),o.error)showMessage(!1,o.error.message,1,4e3,!0);else{spin.hidden=0,spin_msg.hidden=0,console.log(o.paymentIntent.id);let e=0,t=(s.querySelector("#accept_saving_card").checked&&(e=1),new FormData);if(t.append("amount",o.paymentIntent.amount/100),t.append("payment_method_id",o.paymentIntent.payment_method),t.append("payment_intent_id",o.paymentIntent.id),t.append("save_card",e),t.append("q","settings_users_bills_user_payment_intent_confirm"),postFetch(t),1==e){console.log("Saving Card");var n=s.querySelector("#stripe_subscription_id").value;let e=new FormData;e.append("sub_id",n),e.append("payment_intent_id",o.paymentIntent.id),e.append("q","settings_users_bills_stripe_card_save"),postFetch(e)}showMessage(!0,"Subscription Activated"),console.log("Payment Successfull")}})}popup_form_code_back.addEventListener("click",function(e){popup_form_code.contains(e.target)||popupFormCodeHide()});
