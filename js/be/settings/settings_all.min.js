var popup_form_orig_input;const popup_form_code_back=document.getElementById("popup_form_code_back"),popup_form_code=document.querySelector("#popup_form_code"),popup_form_code_message=document.getElementById("form_code_message"),popup_form_code_digits=document.getElementById("form_code_digits");function popupFormCodeShow(){document.querySelector("body").classList.add("noscroll"),popup_form_code_digits.querySelectorAll("input").forEach(function(e){e.addEventListener("input",popupFormCodeChanger),e.addEventListener("focus",popupFormClearThisInput)}),popup_form_code_back.classList.remove("hidden"),popup_form_code.classList.remove("hidden"),popupFormClearAllInputs(),popupFormEnableAllInputs()}function popupFormCodeHide(){document.querySelector("body").classList.remove("noscroll"),document.getElementById("form_code_send_again").classList.add("hidden"),popup_form_code.classList.add("hidden"),popup_form_code_digits.querySelectorAll("input").forEach(function(e){e.removeEventListener("input",popupFormCodeChanger),e.removeEventListener("focus",popupFormClearThisInput)}),popup_form_code_back.classList.add("hidden")}function popupFormClearThisInput(e){e.target.value=""}function popupFormClearAllInputs(){for(let e=1;e<=6;e++)document.getElementById("form_code_"+e).value=""}function popupFormEnableAllInputs(e){for(let n=1;n<=6;n++)document.getElementById("form_code_"+n).disabled=!1;document.getElementById("form_code_1").focus()}function popupFormDisableAllInputs(e){for(let n=1;n<=6;n++)document.getElementById("form_code_"+n).disabled=!0}function popupFormShowMessage(e,n){"msg"==n?(popup_form_code_message.classList.add("tgreen"),popup_form_code_message.classList.remove("tred")):(popupFormDisableAllInputs(),popup_form_code_message.classList.remove("tgreen"),popup_form_code_message.classList.add("tred")),popup_form_code_message.innerText=e,popup_form_code_message.classList.remove("hidden"),setTimeout(function(){popupFormClearAllInputs(),popupFormEnableAllInputs(),popup_form_code_message.innerText="",popup_form_code_message.classList.add("hidden")},2e3)}function popupFormCodeChanger(e){let n=e.target;if(1==n.value.length)null!=n.nextElementSibling&&n.nextElementSibling.focus();else if(6==n.value.length){let s=n.value;if(isNaN(s)){popupFormShowMessage("Pasted code not valid",err);return}for(let o=0;o<6;o++){let i=o+1,l=s.slice(o,i);console.log(i+"-->"+l),document.getElementById("form_code_"+i).value=l}}else{popupFormShowMessage("Code not valid","err");return}let r="";for(let a=1;a<=6;a++)r+=document.getElementById("form_code_"+a).value.toString();let c=document.getElementById("form_code_email").value;6==r.toString().length&&c.length>0&&(console.log("ok sending code: "+r),popupFormCodeCheck(r,c))}function popupFormCodeNew(e){let n,s,o=!1;"form_code_send_again"==e.id?(s=(n=document.getElementById("form_code_email")).value,o=!0):s=(n=e.form.querySelector('input[name="email"]')).value,e.classList.add("loading"),fetch("/register/emailVerifyCode.php?"+(str="q=newcode&email="+s)).then(e=>e.json()).then(e=>{if(document.querySelectorAll("button.loading").forEach(function(e){e.classList.remove("loading")}),document.getElementById("form_code_loader").classList.add("hidden"),console.log(e),e.hasOwnProperty("e"))o?popupFormShowMessage(e.m,"err"):showMessage(!1,e.m);else{if(o)popupFormShowMessage(e.m,"msg");else if(document.querySelector("#form_code_email").value=s,"verification_needed"==e.d)popupFormCodeShow();else if("verification_jump"==e.d){location.href="/register/hotelreg";return}console.log("new code created email sent")}}).catch(e=>{document.querySelectorAll("button.loading").forEach(function(e){e.classList.remove("loading")}),document.getElementById("form_code_loader").classList.add("hidden"),o?popupFormShowMessage(e,"err"):showMessage(!1,e)})}function popupFormCodeCheck(e,n){document.getElementById("form_code_loader").classList.remove("hidden"),popupFormDisableAllInputs(),fetch("/register/emailVerifyCode.php?"+(str="q=checkcode&email="+n+"&code="+e)).then(e=>e.json()).then(e=>{if(document.getElementById("form_code_loader").classList.add("hidden"),e.hasOwnProperty("e"))popupFormShowMessage(e.m,"err"),document.getElementById("form_code_send_again").classList.remove("hidden");else{popupFormCodeHide(),console.log("Code Valid"),showMessage("True",e.m),location.reload();return}}).catch(e=>{popupFormShowMessage(e,"err")})}function popupFormCodeNewResend(e){e.classList.add("hidden"),document.getElementById("form_code_loader").classList.remove("hidden"),popupFormCodeNew(e)}function showRooms(e){let n="",s,o,i,l,r,a,c="",d=document.getElementById("room_list");Array.from(d.querySelectorAll(".room")).forEach(function(e){e.remove()}),Object.entries(e).forEach(function(e){[i,s,r,c,o,l,a]=mapRoom(e);let d=roomsCatImg(a);n+="<li id='"+i+"' class='grid-container no-gap room'  style='grid-template-columns: 3fr 2fr 1fr 1fr 1fr 1fr;'>",n+="	<h4 class='m0'>"+o+"</h4>",n+="	<div class='flex-container flex-col'>",n+="		<span class='m0'><b>"+rooms_types[l]+"</b></span>",n+="		<span class='m0'>"+rooms_categories[a]+"</span>",n+="	</div>",n+="	<img src='/assets/be/icons/"+d+"' class='m0a filter-gray' width='16' height='16' >",n+="	<span>"+s+"</span>",n+="	<div class='flex-container flex-col'>",n+="		<span class=''>"+r+" "+curr+"</span>",c>0&&(n+="		<span class='smaller'><i>"+c+" "+curr+"</i></span>"),n+="	</div>",n+="	<div class='flex-container centered'> ",n+="		<img class='edit-icon' src='/assets/be/icons/user-edit-solid.svg' height='20' alt='"+i+"' onclick='editRoom(this.attributes.alt.value)' width='20'>",n+="		<img class='delete-icon filter-red' src='/assets/be/icons/times-solid.svg' alt='"+i+"' onclick='deleteRoom(this.attributes.alt.value)' height='20' width='20'>",n+="	</div>",n+="</li>"}),n.length,d.innerHTML+=n}function showBottomRoomInfos(e){getParentByClass(e,"season").querySelector(".room-info").classList.toggle("hidden")}function showFormToEditRoom(e){let n,s,o,i,l,r="";document.getElementById("popout_dark_back").hidden=0;let a=document.getElementById("popup_edit_room"),c=a.querySelector("form");a.hidden=0,c.hidden=0,c.querySelectorAll("input").forEach(function(e){e.value=""}),console.log(e),Object.entries(e).forEach(function(e){console.log(e),[o,n,l,r,s,i,cat]=mapRoom(e)}),c.querySelector("input[name=rname]").value=s,c.querySelector("input[name=rprice]").value=l,c.querySelector("input[name=rweprice]").value=r,c.querySelector("input[name=rid]").value=o,c.querySelector("select[name=rtype]").value=i,c.querySelector("select[name=rpax]").value=n,c.querySelector("select[name=rcat]").value=cat}function showFormToEditRoom(e){let n,s,o,i,l,r="";document.getElementById("popout_dark_back").hidden=0;let a=document.getElementById("popup_edit_room"),c=a.querySelector("form");a.hidden=0,c.hidden=0,c.querySelectorAll("input").forEach(function(e){e.value=""}),console.log(e),Object.entries(e).forEach(function(e){console.log(e),[o,n,l,r,s,i,cat]=mapRoom(e)}),c.querySelector("input[name=rname]").value=s,c.querySelector("input[name=rprice]").value=l,c.querySelector("input[name=rweprice]").value=r,c.querySelector("input[name=rid]").value=o,c.querySelector("select[name=rtype]").value=i,c.querySelector("select[name=rpax]").value=n,c.querySelector("select[name=rcat]").value=cat}function mapRoom(e){return rid=e[0],pax=e[1][4],price=e[1][3],weprice=e[1][7],name=e[1][2],[rid,pax,price,weprice,name,type=e[1][1],cat=e[1][5]]}function showUsers(e){let n="",s,o,i,l,r,a,c,d,u,p,m,f,g,h="",y=document.getElementById("users_list");Array.from(y.querySelectorAll(".users")).forEach(function(e){e.remove()}),Object.entries(e).forEach(function(e){[s,o,i,l,r,a,c,d,u,p,m,f,g,h]=mapUser(e);let y="";(0==m||2!=f)&&(y="tlgray"),i<10&&(i=10),null==p&&(p="-");let v=usersCatImg(i),b="checked";0==m&&(b=""),n+="<li id='"+s+"' class='grid-container no-gap users ta-c keep-sizes "+y+"'  style='grid-template-columns: 1fr 1fr 2fr 1fr 1fr 1fr 1fr 1fr;'>",n+="	<h4 class='m0 ta-l'>"+o+"</h4>",n+="	<div class='flex-centered ta-c'>",n+="		<span><b>"+h+"</b></span>",n+="		<img src='/assets/be/icons/"+v+"' class='filter-gray m0a' width='16' height='16' >",n+="	</div>",n+="	<div class='flex-centered ta-c'>",n+="		<span class='m0' style='overflow:hidden'>"+l+"</span>",2!=f&&(g>172800?n+="<a href='#_' class='smaller tred' onClick='sendEmailVerificationUser("+s+")'>Verification Expired. Send new mail.</a>":n+="<a href='#_' class='smaller tred' onClick='sendEmailVerificationUser("+s+")'>Not Verified. Send new mail.</a>"),n+="	</div>",n+="	<div class='flex-container m0a'>",c>0&&(n+="<img alt='icon' src='/assets/be/icons/google.svg' class='filter-g m2p' width='16' height='16'>"),a>0&&(n+="<img alt='icon' src='/assets/be/icons/facebook1.svg' class='filter-fb m2p' width='16' height='16'>"),d>0&&(n+="<img alt='icon' src='/assets/be/icons/lock-solid.svg' class='filter-yellow m2p' width='16' height='16'>"),n+="	</div>",n+="		<span>"+u+"</span>",n+="		<span>"+p+"</span>",n+="	<div class='flex-container centered'> ",i<100&&level>=70&&(n+="<img class='edit-icon m2p' src='/assets/be/icons/user-edit-solid.svg' height='20' alt='"+s+"' onclick='editUser(this.attributes.alt.value)' width='20'>",n+="<img class='delete-icon filter-red m2p' src='/assets/be/icons/times-solid.svg' alt='"+s+"' onclick='deleteUser(this.attributes.alt.value)' height='20' width='20'>"),n+="	</div>",n+="	<div class='flex-container centered'> ",i<100&&s!=uid&&level>=70&&(n+="<div class='switch flex-centered small'> <input type='checkbox' id='toggleUserActive_"+s+"' "+b+" alt='"+s+"' onclick='toggleUser(this); return;'> <label for='toggleUserActive_"+s+"'></label> </div>"),n+="	</div>",n+="</li>"}),n.length,y.innerHTML+=n}function showFormToEditUser(e){let n,s,o,i,l,r,a,c,d,u,p="";document.getElementById("popout_dark_back").hidden=0;let m=document.getElementById("popup_staff"),f=m.querySelector("form");m.hidden=0,f.hidden=0,f.querySelectorAll("input").forEach(function(e){e.value=""}),console.log(e),Object.entries(e).forEach(function(e){[n,s,o,i,l,r,a,c,d,u,p,verificationState]=mapUser(e)}),f.querySelector("input[name=user_name]").value=s,f.querySelector("input[name=uid]").value=n,f.querySelector("select[name=user_role]").value=o,f.querySelector("input[name=user_email]").value=i,f.querySelector("input[name=user_username]").value=l}function mapUser(e){let n,s,o,i,l,r,a,c,d,u,p,m,f,g="";return n=e[0],s=e[1][0][1],o=e[1][0][2],i=e[1][0][3],l=e[1][0][4],r=e[1][0][5],a=e[1][0][6],c=e[1][0][7],d=e[1][0][8],u=e[1][0][9],p=e[1][0][10],m=e[1][0][11],[n,s,o,i,l,r,a,c,d,u,p,m,f=e[1][0][12],g=e[1][0][13]]}function showSeasons(e){let n="",s,o,i,l,r,a,c="",d=document.getElementById("seasons_list");Array.from(d.querySelectorAll(".season")).forEach(function(e){e.remove()}),Object.entries(e).forEach(function(e){console.log(e),[s,i,l,o,recurrent]=mapSeason(e),n+="<li id='"+s+"' class='flex-container flex-col season'>",n+="	<div class='grid-container no-gap m0' style='grid-template-columns: 3fr 2fr 2fr 1fr 1fr;'>",n+="		<h4 class='m0 pointer' onclick='showBottomRoomInfos(this)'><b>"+o+"</b></h4>",n+="		<span>"+i+"</span>",n+="		<span>"+l+"</span>",n+="		<span>"+recurrent+"</span>",n+="		<div class='flex-container centered'> ",n+="			<img class='edit-icon' src='/assets/be/icons/user-edit-solid.svg' height='20' alt='"+s+"' onclick='editSeason(this.attributes.alt.value)' width='20'>",n+="			<img class='delete-icon filter-red' src='/assets/be/icons/times-solid.svg' alt='"+s+"' onclick='deleteSeason(this.attributes.alt.value)' height='20' width='20'>",n+="		</div>",n+="	</div>",n+="	<div class='room-info blgray grid-container grid-3col m0a no-gap hidden w60' style='padding:1em; border-radius: 1em;'>",n+="		<h4 class='m0'>Room Name</h4><h4 class='m0'>Normal Price</h4><h4 class='m0'>Season Price</h4>",Object.entries(e[1]).forEach(function(e){console.log(e),r=e[1][9],a=e[1][8],c=e[1][7],n+="		<h5 class='m0'><b>"+r+"</b></h5>",n+="		<span>"+a+" "+curr+"</span>",n+="		<span><b>"+c+" "+curr+"</b></span>"}),n+="	</div>",n+="</li>"}),d.innerHTML+=n}function showFormToEditSeason(e){let n,s,o,i,l,r,a,c="";showPopup("popup_season_edit");let d=document.getElementById("popup_season_edit").querySelector("form");d.querySelectorAll("input").forEach(function(e){e.value=""}),console.log(e);let u=Object.entries(e)[0];console.log(u),[n,o,i,s,recurrent]=mapSeason(u),console.log(s),d.querySelector("input[name='sname']").value=s,d.querySelector("input[name=sid]").value=n,console.log(o),console.log(i);let p=new Date(o+"T00:00:00.000Z"),m=new Date(i+"T00:00:00.000Z");initDeskyCalendar("edit_season_sd","single",p,null,"edit_season_ed",null,null,!0),initDeskyCalendar("edit_season_ed","single",m,null,null,p,null,!0),Object.entries(u[1]).forEach(function(e){r=e[1][9],a=e[1][8],c=e[1][7],l=e[1][6],d.querySelector("input[name='"+l+"']").value=c})}function mapSeason(e){return sid=e[0],sd=e[1][0][3],ed=e[1][0][4],recurrent=e[1][0][5],[sid,sd,ed,name=e[1][0][1],recurrent]}function editSiblingBeforeCallBack(e,n){if(!n.hasOwnProperty("d"))return!1;let s=document.getElementById(e);cancelSiblingBefore(s.parentElement.querySelector("form")),console.log(n.d),s.querySelector("span").innerText=n.d}function makeSelectFromParsed(e,n){let s="",o=document.getElementById(n),i="";"location_settings"==n&&(i=document.getElementById("select_countries_list"),e.forEach(function(e){s+="<option value='"+e.alpha2Code+"'>"+e.name+"</option>"})),i.innerHTML=s;let l=o.querySelector(".content"),r=o.querySelector("form");l.classList.add("hidden"),r.classList.remove("hidden")}function showCurrencies(e){let n="";Object.values(e).forEach(function(e){if(3!=e[0].length)return!1;n+="<div class='tag flex-container space-between'>",n+="	<span class='smaller'>"+e[0]+"</span><div class='flex-centered'><img src='/assets/be/icons/times-solid.svg' onclick='deletePrevSiblingExtraCurrency(this)' width='12' height='12'></div>",n+="</div>"}),document.getElementById("currencies_list").lastElementChild.innerHTML=n}function showExtrasServices(e){let n="",s=document.getElementById("extras_list"),o=s.querySelector("ul");Array.from(s.querySelectorAll(".xtra")).forEach(function(e){e.remove()}),Object.values(e).forEach(function(e){console.log(e),n+="	<li class='grid-container grid-411col mb1 xtra'>",n+="		<div>"+e[1]+"</div>",n+="		<div>"+e[2]+"</div>",n+="		<img src='/assets/be/icons/times-solid.svg' onclick='deleteExtraService("+e[0]+")' class='filter-red pointer' width='12' height='12'>",n+="	</li>"}),o.innerHTML+=n}function showReturnableDeposits(e){let n="",s=document.getElementById("deposits_list"),o=s.querySelector("ul");Array.from(s.querySelectorAll(".xtra")).forEach(function(e){e.remove()}),Object.values(e).forEach(function(e){console.log(e),n+="	<li class='grid-container grid-411col mb1 xtra'>",n+="		<div>"+e[1]+"</div>",n+="		<div>"+e[2]+"</div>",n+="		<img src='/assets/be/icons/times-solid.svg' onclick='deleteReturnableDeposit("+e[0]+")' class='filter-red pointer' width='12' height='12'>",n+="	</li>"}),o.innerHTML+=n}function showTaxes(e){let n="",s=document.getElementById("taxes_list"),o=s.querySelector("ul");Array.from(s.querySelectorAll(".xtra")).forEach(function(e){e.remove()}),Object.values(e).forEach(function(e){console.log(e),n+="	<li class='grid-container grid-3col mb1 xtra'>",n+="		<div>"+e[1]+"</div>",n+="		<div class='bold'>"+e[2]+" <span class='smaller'>%</span></div>",n+="		<img src='/assets/be/icons/times-solid.svg' onclick='deleteTax("+e[0]+")' class='filter-red pointer' width='12' height='12'>",n+="	</li>"}),o.innerHTML+=n}function showPaymentMethods(e){let n="",s=document.getElementById("payment_methods_list"),o=s.querySelector("ul");Array.from(s.querySelectorAll(".xtra")).forEach(function(e){e.remove()}),Object.values(e).forEach(function(e){console.log(e),n+="	<li class='grid-container grid-411col mb1 xtra'>",n+="		<div>"+e[1]+"</div>",n+="		<div class='flex-centered'>",1==e[2]?n+="<img src='/assets/be/icons/check-solid.svg' class='filter-green m0a' width='20' height='20'>":n+="<a href='#' onclick='setPaymentMethodAsDefault("+e[0]+");' style='font-size:0.6em;'>Set Default</a>",n+="		</div>",n+="		<img src='/assets/be/icons/times-solid.svg' onclick='deletePaymentMethod("+e[0]+")' class='filter-red pointer' width='12' height='12'>",n+="	</li>"}),o.innerHTML+=n}function stripeProcess(e){if(spin.hidden=1,spin_msg.hidden=1,console.log(e),!e.hasOwnProperty("q")){showMessage(!1,"Bad formatted response");return}let n=e.q;if("settings_users_bills_stripe_card_save"==n){showMessage(!0,"Card saved as default payment method");return}stripeHideAllSections();let s=e.user.stripe_user_id,o=e.user.state,i=e.user.ed_actual_subscription,l=e.user.stripe_subscription_id,r=e.user.stripe_payment_intent_client_secret;if(1==o){if("settings_users_bills_user_payment_intent_confirm"==n){document.getElementById("stripe_subscription_payment_ok").classList.remove("hidden"),setTimeout(function(){goSettings("b_settings_users","b_settings_users_bills")},500);return}let a=document.getElementById("stripe_subscription_is_active");if(a.classList.remove("hidden"),null==i){a.querySelector(".subEd").innerText="Updating...";let c=new FormData;c.append("q","settings_users_bills_stripe_subscription_update_local"),postFetch(c)}else{let d=i.split(/[- :]/);d[1]--;let u=new Date(Date.UTC(...d));if(a.querySelector(".subEd").innerText=u.toLocaleString(),"settings_users_bills_stripe_subscription_update_local"==n)return}let p="";if(null!=e.payments){for(a=document.querySelector(".sub-payments ul");a.firstChild;)a.removeChild(a.firstChild);let m=0;Array.from(Object.values(e.payments)).forEach(function(e){if(++m>=4)return;console.log(e);let n=e.insert_date.split(/[- :]/);n[1]--;let s=new Date(Date.UTC(...n)),o="done";0==e.status&&(o="error");let i="manual";1==e.automatic&&(i="cyclic"),p="<li id="+e.stripe_pi_id+' class="grid-container grid-4col">',p+="	<span>"+s.toLocaleString()+"</span>",p+="	<span>"+o+"</span>",p+="	<span>"+i+"</span>",p+='	<h3 class="ta-r m0"><b>'+e.amount+" USD</b></h3>";let l=parseHTML(p+="</li>");a.appendChild(l)})}if(null!=e.cards){for(a=document.querySelector(".sub-cards ul");a.firstChild;)a.removeChild(a.firstChild);Array.from(Object.values(e.cards)).forEach(function(e){console.log(e);let n=e.expire.substr(0,7).replace("-","/");p="<li id="+e.stripe_pm_id+' class="grid-container stripe-card grid-2col noarrow" style="line-height: 2em">',p+='	<div class="flex-container">',p+='		<span class="tag ta-c twhite flex-centered mr1 smaller" style="background-color: #000074; width: fit-content; min-width: 25px; height: 25px">',p+="			<b>"+e.brand.toUpperCase()+"</b>",p+="		</span>",p+='		<span class="small ta-r  flex-centered" style="line-height: 1.3em">',p+='			<span><span class="mr1 tgray">'+e.brand.toUpperCase()+"</span> *** "+e.last4+"</span>",p+='			<span class="tlgray">Expire: '+n+"</span>",p+="		</span>",p+="	</div>",parseHTML(p+="</li>")})}}else if(8==o){let f=document.getElementById("stripe_subscription_cancel_at_period_end");f.classList.remove("hidden");let g=new Date(i+" UTC");f.querySelector(".subEd").innerText=g.toLocaleString()}else if(null!=l)console.log(">>> STEP 2: has stripe id, has subscription, no payment. From Request --> "+n),document.querySelector("#stripe_collect_payment").classList.remove("hidden"),document.querySelector("#stripe_client_secret").value=r,document.querySelector("#stripe_subscription_id").value=l,initStripeCardForm();else if(null==s||s.length<2){console.log(">>> STEP 0: no stripe id "),console.log(">>> STEP 0: Creating user on stripe..."),spin.hidden=0,spin_msg.hidden=0;let h=new FormData;h.append("q","settings_users_bills_stripe_subscription_create"),postFetch(h)}else{console.log(">>> STEP 8-0: No Subscription, but stripe id "),console.log(">>> STEP 8-0: Subscription was canceled, create a new one"),spin.hidden=0,spin_msg.hidden=0;let y=new FormData;y.append("q","settings_users_bills_stripe_subscription_create"),postFetch(y)}}function stripeHideAllSections(){document.querySelectorAll("section").forEach(function(e){e.classList.add("hidden")})}function hideAllSubMenus(){Array.from(document.querySelectorAll(".sub-top-bar")).forEach(function(e){e.classList.add("hidden")})}function hideAllSections(){Array.from(document.querySelectorAll(".section")).forEach(function(e){e.classList.add("hidden")})}function setActive(e){Array.from(e.parentElement.children).forEach(function(e){e.classList.remove("active")}),e.classList.add("active")}function disableAllButtons(){Array.from(document.querySelectorAll(".config-tile")).forEach(function(e){e.classList.add("disabled")})}function enableAllButtons(){Array.from(document.querySelectorAll(".config-tile")).forEach(function(e){e.classList.remove("disabled")})}function enableAButton(e){document.getElementById(e).classList.remove("disabled")}function clickAButton(e,n=!1){let s=document.getElementById(e);Boolean(n)&&s.classList.contains("disabled")&&enableAButton(e),document.getElementById(e).click()}function menuClick(e){let n=e.target;if(n.classList.contains("disabled"))return;let s=0;for(;!n.classList.contains("config-tile")&&(n=n.parentElement,!(++s>3)););checkSyncRoomsReload(),n.classList.contains("right-tile")&&cleanJsonUlLists();let o=n.id;if("b_logout"==o){location.href="/register/logout.php";return}"b_settings_property_rooms"==o?loadRooms():"b_settings_property_extra"==o?loadExtraServices():"b_settings_property_payment_methods"==o?loadPaymentMethods():"b_settings_seasons_main"==o?loadSeasons():"b_settings_property_deposits"==o?loadReturnableDeposits():"b_settings_property_taxes"==o?loadTaxes():"b_settings_users_staff"==o?loadUsers():"b_settings_users_bills"==o&&loadBills();let i=o.substr(2);setActive(n),hideAllSections();let l=document.getElementById(i);l&&(n.classList.contains("left-tile")?(setCookie("menu1",o,.003),hideAllSubMenus(),l.classList.remove("hidden"),document.getElementById(i).firstElementChild.click()):(setCookie("menu2",o,.003),document.getElementById(o).classList.remove("hidden"),l.classList.remove("hidden")))}function propertyChange(e){let n=e.value;n!=hid&&(console.log("Trying switch to property: "+n),location.href="/workspace/switch.php?p="+n)}function checkSyncRoomsReload(){let e=Array.from(document.getElementById("room_list").querySelectorAll("li.room")).length;e!=document.getElementById("conf_rooms_by_db").innerText&&e>0&&location.reload()}function loadRooms(){postHttpReq("settings_room_show")}function deleteRoom(e){console.log(e),postHttpReq("settings_room_delete",out=[e])}function editRoom(e){console.log(e),postHttpReq("settings_room_edit",out=[e])}function setRoomsImages(){Array.from(document.getElementById("popup_season_add").querySelectorAll(".rcat")).forEach(function(e){let n=roomsCatImg(e.attributes.alt.value);e.attributes.src.value="/assets/be/icons/"+n,e.hidden=0})}function loadCurrencies(){postHttpReq("settings_show_currencies")}function deletePrevSiblingExtraCurrency(e){postHttpReq("settings_delete_extra_currency",e.parentElement.previousElementSibling.innerText)}function loadPaymentMethods(){postHttpReq("settings_payment_method_get")}function deletePaymentMethod(e){console.log("delete x "+e),postHttpReq("settings_payment_method_delete",out=[e])}function setPaymentMethodAsDefault(e){console.log("defualt "+e),postHttpReq("settings_payment_method_default",out=[e])}function loadExtraServices(){postHttpReq("settings_extra_show")}function deleteExtraService(e){console.log("delete x "+e),postHttpReq("settings_extra_delete",out=[e])}function loadReturnableDeposits(){postHttpReq("settings_deposits_show")}function deleteReturnableDeposit(e){console.log("delete x "+e),postHttpReq("settings_deposit_delete",out=[e])}function loadTaxes(){postHttpReq("settings_tax_show")}function deleteTax(e){console.log("delete x "+e),postHttpReq("settings_tax_delete",out=[e])}function loadSeasons(){postHttpReq("settings_season_show")}function editSeason(e){console.log(e),postHttpReq("settings_season_edit",out=[e])}function deleteSeason(e){console.log(e),postHttpReq("settings_season_delete",out=[e])}function passwordChange(){document.getElementById("user_password_action").value="change_password",document.getElementById("user_current_password_container").classList.remove("hidden"),showPopup("popup_password")}function passwordSet(){document.getElementById("user_password_action").value="new_password",document.getElementById("user_current_password_container").classList.add("hidden"),showPopup("popup_password")}function loadUsers(){postHttpReq("settings_users_show",[])}function editUser(e){console.log(e),postHttpReq("settings_user_edit",out=[e])}function deleteUser(e){console.log(e),postHttpReq("settings_user_delete",out=[e])}function toggleUser(e){let n=e.attributes.alt.value,s=e.checked;console.log(n+" -- "+s),postHttpReq("settings_user_toggle",["&uid="+n+"&checked="+s])}function sendEmailVerificationUser(e){console.log(e),postHttpReq("settings_user_email_reverify",out=[e])}function loadBills(){if(108==level){document.getElementById("still_free_beta_test").classList.remove("hidden");return}if(level>=120&&level<150&&subscriptionMissingSeconds>0){document.getElementById("still_free_tier_subscription").classList.remove("hidden");return}spin.hidden=0,spin_msg.hidden=0;let e=new FormData;e.append("q","settings_users_bills_user_get"),postFetch(e)}function stripeDeleteCard(e){let n=getParentByType(e,"LI");console.log("delete card "+n.id);let s=new FormData;s.append("q","settings_users_bills_stripe_card_delete"),s.append("card",n.id),confirm("Deleting card, automatic payments will be disabled. Are you sure?")&&postFetch(s)}function stripeCancelSubscription(){let e=new FormData;e.append("q","settings_users_bills_stripe_subscription_cancel"),confirm("Subscription will be valid till End Date, but no more charges will be applied. Are you sure?")&&postFetch(e)}function showFormBottom(e){let n=e.form,s=n.nextElementSibling;n.hidden=1,s.hidden=0}function hideFormBottom(e){let n=e.form,s=n.previousElementSibling;n.hidden=1,s.hidden=0}function editSiblingBefore(e){let n=e.previousElementSibling,s=n.attributes.alt.value,o=n.firstElementChild.innerText,i=n.lastElementChild.innerText;console.log(o+"--"+i);let l=e.parentElement;if(l.getElementsByTagName("form").length>0)return!1;l.children.forEach(function(e){e.hidden=1});let r=createEditForm(s,i,o);e.parentElement.innerHTML+=r}function cancelSiblingBefore(e){e.parentElement.children.forEach(function(e){e.hidden=0}),e.remove()}function createEditForm(e,n,s){let o,i="";return"hname"==e&&(o="settings_update_hotel_name"),i+="<form class='flex-container centered editSiblingBefore' alt='"+o+"'>",i+="	<label for='id_"+e+"' class='hidden'>Name: </label>",i+="	<input id='id_"+e+"' name='"+e+"' placeholder='"+s+"' class='shadow dgreen mandatory mr2' value='"+n+"'>",i+="	<button class='transparent p0' type='button' onclick='editSiblingBeforePrepareSubmit(this)'>",i+="		<img src='/assets/be/icons/check-solid.svg' class='filter-green'  width='20' height='20'>",i+="	</button>",i+="	<button class='transparent p0 cancel' type='button' onclick='cancelSiblingBefore(this.form)'>",i+="		<img src='/assets/be/icons/times-solid.svg' class='filter-red'  width='20' height='20'>",i+="	</button>",i+="</form>"}function editSiblingBeforePrepareSubmit(e){let n=e.form.attributes.alt.value;formSubmitXML(e,n)}function geoFindMe(){if(!navigator.geolocation){console.log("Geolocation is not supported by your browser");return}navigator.geolocation.getCurrentPosition(function e(n){var s=n.coords.latitude;reverseGeocodingWithGoogle(n.coords.longitude,s)},function e(){console.log("Unable to retrieve your location")})}function reverseGeocodingWithGoogle(e,n){fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${e},${n}&key={GOOGLE_MAP_KEY}`).then(e=>e.json()).then(e=>{console.log("User's Location Info: ",e)}).catch(e=>{console.log("Request failed.  Returned status of",e)})}function geocodingWithGoogle(e,n){if(n.value.length<3)return!1;let s="";fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${n.value}&key=AIzaSyBjsw41QanLXuD36cKvfe7r54WciCTDTKg`).then(e=>e.json()).then(e=>{let n=document.getElementById("results_query_maps"),o=countryCode=region=city=locality=sublocality=route=t=src="";for(;n.firstChild;)n.removeChild(n.firstChild);Array.from(e.results).forEach(function(e){console.log(e);let i=!1,l="";Object.values(e.types).indexOf("lodging")>=0?(src="/assets/be/icons/hotel.svg",i=!0):src="/assets/be/icons/map-marker-alt-solid.svg",i&&(s=e.place_id),e.address_components.forEach(function(e){e.types.forEach(function(n){"country"==n?(o=e.long_name,countryCode=e.short_name):"administrative_area_level_1"==n?region=e.long_name:"locality"==n?locality=e.long_name:"sublocality_level_1"==n?sublocality=e.long_name:"route"==n&&(route=e.long_name)})}),l+="<li onclick='getGoogleResultsAndSetForm(this)'>",l+="	<div class='flex-container flex-col'>",l+="		<div class='grid-container grid-1col country-infos ta-c' style='grid-auto-rows: 1fr'>",l+="			<div class='flex-centered'>",l+="				<div class='flex-container'>",l+="					<div class='flex-centered'>",l+="						<img src='"+src+"' class='filter-red m1' width='24' height='24'>",l+="						<span class='hidden' alt='place_id'>"+s+"</span>",l+="					</div>",l+="					<div class='flex-centered m1'>",l+="						<span alt='hroute'><b>"+route+"</b></span>",l+="						<span alt='hsubloc' class='smaller'><i>"+sublocality+"</i></span>",l+="					</div>",l+="					<div class='flex-centered m1'>",l+="						<span alt='hcity'>"+locality+"</span>",l+="						<span alt='hregion' class='smaller'>"+region+"</span>",l+="					</div>",l+="					<div class='flex-centered m1'>",l+="						<span alt='hcountry' class='bigger'>"+o+" <span alt='hccode'>("+countryCode+")</span></span>",l+="					</div>",l+="				</div> ",l+="			</div> ",l+="		</div>",l+="	</div>";let r=parseHTML(l+="</li>");n.append(r)}),n.parentElement.classList.remove("hidden"),document.addEventListener("click",hideGoogleSearchResult)}).catch(e=>{console.log("Request failed.  Returned status of",e)})}function getGoogleResultsAndSetForm(e){let n=document.getElementById("results_query_maps"),s=document.getElementById("settings_update_location").querySelector("form");s.querySelector("input[name=hcountry]").value=e.querySelector("span[alt=hcountry]").innerText,s.querySelector("input[name=hccode]").value=e.querySelector("span[alt=hccode]").innerText,s.querySelector("input[name=hregion]").value=e.querySelector("span[alt=hregion]").innerText,s.querySelector("input[name=hcity]").value=e.querySelector("span[alt=hcity]").innerText,s.querySelector("input[name=hroute]").value=e.querySelector("span[alt=hroute]").innerText,s.querySelector("input[name=hroute]").value+=" "+e.querySelector("span[alt=hsubloc]").innerText,s.querySelector("input[name=place_id]").value=e.querySelector("span[alt=place_id]").innerText,(n=document.querySelector("#google_map_search")).value=s.querySelector("input[name=hroute]").value+", "+e.querySelector("span[alt=hcity]").innerText+", "+e.querySelector("span[alt=hcountry]").innerText}function hideGoogleSearchResult(){let e=document.getElementById("query_maps_search_result");e.classList.contains("hidden")||(e.classList.toggle("hidden"),console.log("closed"),document.removeEventListener("mousedown",hideGoogleSearchResult))}function editSettingCard(e,n){let s=document.getElementById(n),o=s.querySelector(".content"),i=s.querySelector("form");o.classList.add("hidden"),i.classList.remove("hidden")}function closeEditSettingCard(e,n){let s=document.getElementById(n),o=s.querySelector(".content"),i=s.querySelector("form");o.classList.remove("hidden"),i.classList.add("hidden")}function setAllCurrenciesSelect(e){document.querySelectorAll("select[name=currency]").forEach(function(n){for(var s,o=0;s=n.options[o];o++)if(s.value==e){n.selectedIndex=o;break}})}function percentCurrencyChanger(e){let n=e.value,s="";s=0==n?curr:"%",document.getElementById("percent_curr_symbol").innerText=s}function settingsToggleOption(e){let n=e.id,s=e.checked,o=e.dataset.method,i;i=s?1:0;let l=new FormData;l.append("opt",n),l.append("val",i),l.append("q",o),postFetch(l)}function cleanJsonUlLists(){document.querySelectorAll(".json-ul-list").forEach(function(e){e.querySelectorAll("li").forEach(function(e){e.classList.contains("header")||e.remove()})})}function initStripeCardForm(){null===stripeElements.getElement("card")&&(spin.hidden=0,spin_msg.hidden=0,(cardElement=stripeElements.create("card",{style:{base:{color:"#666",fontWeight:"500",fontFamily:"Roboto",fontSize:"16px",fontSmoothing:"antialiased",":-webkit-autofill":{color:"#998000"},"::placeholder":{color:"#87BBFD"}}},hidePostalCode:!0})).mount("#card-element"),cardElement.on("change",function(e){displayError(e)}),spin.hidden=1,spin_msg.hidden=1)}function displayError(e){let n=document.getElementById("card-element-errors");e.error?n.textContent=e.error.message:n.textContent=""}function confirmPayment(e){let n=e.form;if(!checkMandatory(n))return!1;if(!n.querySelector("#accept_privacy_policy").checked)return showMessage(!1,"You need to accept the privacy policy"),!1;spin.hidden=0,spin_msg.hidden=0;let s=stripeElements.getElement("card"),o=document.getElementById("stripe_payment_name").value,i=document.getElementById("stripe_client_secret").value;stripe.confirmCardPayment(i,{payment_method:{card:s,billing_details:{name:o}}}).then(e=>{if(console.log(e),spin.hidden=1,spin_msg.hidden=1,displayError(e),e.error)showMessage(!1,e.error.message,1,4e3,!0);else{spin.hidden=0,spin_msg.hidden=0,console.log(e.paymentIntent.id);let s=0;n.querySelector("#accept_saving_card").checked&&(s=1);let o=new FormData;if(o.append("amount",e.paymentIntent.amount/100),o.append("payment_method_id",e.paymentIntent.payment_method),o.append("payment_intent_id",e.paymentIntent.id),o.append("save_card",s),o.append("q","settings_users_bills_user_payment_intent_confirm"),postFetch(o),1==s){console.log("Saving Card");let i=n.querySelector("#stripe_subscription_id").value,l=new FormData;l.append("sub_id",i),l.append("payment_intent_id",e.paymentIntent.id),l.append("q","settings_users_bills_stripe_card_save"),postFetch(l)}showMessage(!0,"Subscription Activated"),console.log("Payment Successfull")}})}popup_form_code_back.addEventListener("click",function(e){popup_form_code.contains(e.target)||popupFormCodeHide()});