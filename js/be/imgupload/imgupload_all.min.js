var refs={};function processFile(e){e&&("undefined"!=typeof bid&&setCookie("booking_file_upload",bid,1),uploadImageControl("showProgress"),refs.messageBox.innerHTML="Converting..",new Promise(function(s,i){let r=new Image;r.addEventListener("load",function(){s(r)}),r.src=URL.createObjectURL(e)}).then(function(e){return new Promise(function(s,i){let r=document.createElement("canvas"),o=r.getContext("2d"),t=e.width,n=e.height,a=0;refs.messageBox.innerHTML="Resizing..",(e.width>1e3||e.height>1e3)&&(e.width>=e.height?(t=1e3,a=e.width/1e3,n=e.height/a):(n=1e3,a=e.height/1e3,t=e.width/a)),console.log(e.width+" "+e.height+">>>"+t+" "+n),r.width=t,r.height=n,o.fillStyle="#fff",o.drawImage(e,0,0,t,n),refs.messageBox.innerHTML="Converting..",r.toBlob(function(e){s(URL.createObjectURL(e)),fetch("/servers/bookingImgUpload.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.hasOwnProperty("e")?(showMessage(!1,e.m,3),uploadImageControl("showUploadMethods")):(uploadImageControl("hideProgress"),location.pathname.includes("phoneUpload")&&(refs.messageBox.innerHTML="<h3>File Uploaded!</h3><h3>You can close this page</h3>"),showMessage(!0,e.m,3))}),console.log(e),console.log(e.type)},"image/jpeg")})}).then(function(e){return new Promise(function(s,i){let r=new Image;refs.messageBox.innerHTML="Scaling..",r.addEventListener("load",function(){s({imageURL:e,scaledImg:r})}),r.setAttribute("src",e)})}).then(function(e){refs.messageBox.innerHTML="Uploading..",refs.imageBox.classList.remove("hidden"),refs.imageBox.style.backgroundImage="url("+e.imageURL+")",booking_file_name=e.imageURL}))}function fileSelectorChanged(){processFile(refs.fileSelector.files[0]),refs.fileSelector.value=""}function fileSelectorClick(){refs.fileSelector.click()}function uploadImageControl(e,s){"showProgress"==e?(refs.imagePreviews.classList.remove("hidden"),refs.progressBox.classList.remove("hidden"),refs.imageBox.classList.add("hidden"),refs.divUploadsMethods.classList.add("hidden")):"showUploadMethods"==e?(refs.imagePreviews.classList.add("hidden"),refs.imageBox.classList.add("hidden"),refs.progressBox.classList.add("hidden"),refs.imageBox.style.backgroundImage="",refs.divUploadsMethods.classList.remove("hidden"),generateNewQrCodeFileUpload()):"hideProgress"==e?(refs.progressBox.classList.add("hidden"),refs.messageBox.innerHTML=""):"showPreview"==e&&(refs.imagePreviews.classList.remove("hidden"),refs.divUploadsMethods.classList.add("hidden"),refs.imageBox.classList.remove("hidden"),refs.imageBox.style.backgroundImage="url("+s+")")}refs.imagePreviews=document.querySelector("#previews"),refs.fileSelector=document.querySelector("input[type=file]"),refs.divUploadsMethods=document.querySelector("#upload_file_methods"),null!=refs.imagePreviews&&(refs.imageBox=refs.imagePreviews.querySelector("div.image"),refs.progressBox=refs.imagePreviews.querySelector("progress"),refs.messageBox=refs.imagePreviews.querySelector("span.message"),refs.fileSelector.addEventListener("change",fileSelectorChanged));