function getTopDashboardDatas(e,t){0==arguments.length&&(e=document.querySelector(".a-selectors button.default"),t="today");let a=document.getElementById("section-one"),n=(a.querySelectorAll(".a-selectors button").forEach(function(e){e.classList.add("lgray"),e.classList.remove("green"),e.disabled=1}),e.classList.remove("lgray"),e.classList.add("green"),sded=sdEdFromString(t),new FormData);n.append("q","dashboard_top_datas"),n.append("sd",sded[0]),n.append("ed",sded[1]),postFetch(n)}function getTopDashboardTodayChekinsOut(){let e=new FormData;e.append("q","dashboard_today_checkins_checkouts"),postFetch(e)}function getOccupancy(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_occupancy_timeframe"),t.append("sd",sded[0]),t.append("ed",sded[1])}function getOccupancyDayByDay(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_occupancy_by_days"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getOccupancyByRooms(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_occupancy_by_rooms"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getEarningsDayByDay(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_earnings_by_days"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getIncomingsByPaymentMethod(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_incomings_by_payment_method"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getBookingsDayByDay(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_bookings_by_days"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getBookingsChannels(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_bookings_channels"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function sdEdFromString(e){let t,a="";let n="",o,r,s,d=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),i=new Date;var l=i.getMonth(),c=i.getFullYear();i.getDate();if("today"==e)[{value:r},,{value:o},,{value:s}]=d.formatToParts(i),a=s+"-"+r+"-"+o,t=a;else if("yesterday"==e)i.setTime(i.getTime()-864e5),[{value:r},,{value:o},,{value:s}]=d.formatToParts(i),a=s+"-"+r+"-"+o,t=a;else if("last_week"==e)[{value:r},,{value:o},,{value:s}]=d.formatToParts(i),a=s+"-"+r+"-"+o,i.setTime(i.getTime()-5184e5),[{value:r},,{value:o},,{value:s}]=d.formatToParts(i),t=s+"-"+r+"-"+o;else if("last_30_days"==e)[{value:r},,{value:o},,{value:s}]=d.formatToParts(i),a=s+"-"+r+"-"+o,i.setTime(i.getTime()-2592e6),[{value:r},,{value:o},,{value:s}]=d.formatToParts(i),t=s+"-"+r+"-"+o;else if("current_year"==e)a=c+"-12-31",t=c+"-01-01";else if("last_year"==e)a=c-1+"-12-31",t=c-1+"-01-01";else if("last_month"==e)n=new Date(c,l,0),[{value:r},,{value:o},,{value:s}]=d.formatToParts(n),a=s+"-"+r+"-"+o,t=s+"-"+r+"-01";else if("this_month"==e)n=new Date(c,l+1,0),[{value:r},,{value:o},,{value:s}]=d.formatToParts(n),a=s+"-"+r+"-"+o,t=s+"-"+r+"-01";else if("ever"==e)a="2125-12-31",t="2020-01-01";else{let e=new Date;e.setTime(parseInt(i.getTime())-1296e6),[{value:r},,{value:o},,{value:s}]=d.formatToParts(e),t=s+"-"+r+"-"+o,e.setTime(+i.getTime()+1296e6),[{value:r},,{value:o},,{value:s}]=d.formatToParts(e),a=s+"-"+r+"-"+o}return[t,a]}function setTodayTomorrowYesterday(){let e=new Date;format=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),[{value:month},,{value:day},,{value:year}]=format.formatToParts(e),today=year+"-"+month+"-"+day,console.log("today set to "+today),e.setTime(e.getTime()+864e5),[{value:month},,{value:day},,{value:year}]=format.formatToParts(e),tomorrow=year+"-"+month+"-"+day,e.setTime(e.getTime()-1728e5),[{value:month},,{value:day},,{value:year}]=format.formatToParts(e),yesterday=year+"-"+month+"-"+day}function getDueInvoices(t,e){let a=(t=null==t?document.getElementById("due_8"):t).parentElement,n=(a.children.forEach(function(e){e==t?(e.classList.add("green"),e.classList.remove("tlgray")):(e.classList.remove("green"),e.classList.add("tlgray"))}),new FormData);n.append("state",e),n.append("q","dashboard_due_invoices"),postFetch(n)}function drawGraph(e,t,a,n,o){"line"==n?Boolean(graphScriptLoaded)?(chart[e]&&"function"==typeof chart[e].destroy&&(chart[e].destroy(),console.log("Chart destroyed")),chart[e]=graph_init_line(t,a,e,o)):loadScript("https://cdn.jsdelivr.net/npm/chart.js@3.4.1",function(){graphScriptLoaded=!0,chart[e]=graph_init_line(t,a,e,o)}):"doughnut"==n&&(Boolean(graphScriptLoaded)?(chart[e]&&"function"==typeof chart[e].destroy&&(chart[e].destroy(),console.log("Chart destroyed")),chart[e]=graph_init_doughnut(t,a,e,o)):loadScript("https://cdn.jsdelivr.net/npm/chart.js@3.4.1",function(){graphScriptLoaded=!0,chart[e]=graph_init_doughnut(t,a,e,o)}))}function graph_init_line(e,t,a,n){var a=document.getElementById(a).getContext("2d"),o=[];let r=0;return Object.entries(t).forEach(function(e){o[r]={data:e[1].datas,label:e[0],borderWidth:e[1].width,borderColor:e[1].color,backgroundColor:e[1].color,radius:1,fill:e[1].fill,tension:.5},r++}),new Chart(a,{type:"line",data:{labels:e,datasets:o},options:{responsive:!0,aspectRatio:n,plugins:{legend:{labels:{font:{size:10},boxWidth:20,padding:5},onHover:function(e){e.native.target.style.cursor="pointer"},onLeave:function(e){e.native.target.style.cursor="default"}}},scales:{x:{grid:{display:!1},ticks:{font:{size:10}}},y:{display:!0,beginAtZero:!0,grid:{},ticks:{font:{size:10}}}}}})}function graph_init_doughnut(t,a,e,n){e=document.getElementById(e).getContext("2d");let o=[],r=[],s=[],d=0;Object.keys(t).forEach(function(e){o[d]=e,r[d]=t[e],s[d]=a[e],d++});var i={labels:o,datasets:[{data:s,backgroundColor:r,hoverOffset:4}]};return new Chart(e,{type:"doughnut",data:i,options:{responsive:!0,plugins:{legend:{labels:{font:{size:10},boxWidth:20},onHover:function(e){e.native.target.style.cursor="pointer"},onLeave:function(e){e.native.target.style.cursor="default"}}},scales:{x:{display:!1,grid:{display:!1},ticks:{font:{size:10}}},y:{display:!1,beginAtZero:!0,grid:{display:!1},ticks:{font:{size:10}}}}}})}var ratio=2.5;function callDashTopDatas(t){if(t.hasOwnProperty("tot_customers")){let e=document.getElementById("section-one");e.querySelectorAll(".a-selectors button").forEach(function(e){e.disabled=0}),document.querySelector(".guests-number").innerText=t.tot_customers,document.querySelector(".incomings-number").innerText=t.tot_payments,document.querySelector(".outgoings-number").innerText=t.tot_outgoings;t=t.tot_payments-t.tot_outgoings;document.querySelector(".earnings-number").innerText=t}}function callTopDashboardTodayChekinsOut(e){let t=totout=0;Array.from(Object.values(e)).forEach(function(e){console.log(e),"TODAY"==e[0]?"IN"==e[2]?(t+=parseInt(e[3]),1==e[1]&&(document.getElementById("today_checkins_miss").innerHTML=e[3])):"OUT"==e[2]&&(totout+=parseInt(e[3]),5==e[1]&&(document.getElementById("today_checkouts_miss").innerHTML=e[3])):"YESTERDAY"==e[0]&&("IN"==e[2]?document.getElementById("yday_checkins").innerHTML=e[3]:"OUT"==e[2]&&(document.getElementById("yday_checkouts").innerHTML=e[3]))}),document.getElementById("today_checkins").innerHTML=t,document.getElementById("today_checkouts").innerHTML=totout}function callDashOccupancy(e){var t=Date.parse(e.sd);Date.parse(e.ed);Object.entries(roomsA).forEach(function(e){e[0],e[1][1]})}function callDashOccupancyDayByDay(o){var r,s=Date.parse(o.sd);let d=[],i={Shared:{datas:[]},Privates:{datas:[]},Total:{datas:[]}};var e=(Date.parse(o.ed)-s)/864e5+1;let l=0,c=1,u=document.getElementById("occupancy-card");for(let n=0;n<e;n++){var y=s+864e5*n,g=([{value:y},,{value:r},,{value:g}]=format.formatToParts(y),g+"-"+y+"-"+r);d.push(y+"-"+r);let e=0,t=0,a=(o.hasOwnProperty(g)&&(o[g].hasOwnProperty("1")&&(e=o[g][1]/dorm_beds_tot),o[g].hasOwnProperty("0")&&(t=o[g][0]/priv_rooms_tot)),(e*dorm_beds_tot+t*priv_rooms_tot)/(dorm_beds_tot+priv_rooms_tot));isNaN(a)&&(a=0),g==today?(u.querySelector(".today-number").innerText=parseInt(100*a)+"%",document.querySelector("#today_priv_occ").innerText=parseInt(100*t)+"%",document.querySelector("#today_shar_occ").innerText=parseInt(100*e)+"%"):g==tomorrow?u.querySelector(".tomorrow-number").innerText=parseInt(100*a)+"%":g==yesterday&&(u.querySelector(".tomorrow-number").innerText=parseInt(100*a)+"%",document.querySelector("#yday_priv_occ").innerText=parseInt(100*t)+"%",document.querySelector("#yday_shar_occ").innerText=parseInt(100*e)+"%"),i.Privates.datas[n]=parseInt(100*t),i.Shared.datas[n]=parseInt(100*e),i.Total.datas[n]=parseInt(100*a),l+=a,c++}i.Privates.color="slategray",i.Privates.width=2,i.Privates.fill=!1,i.Shared.color="yellow",i.Shared.width=2,i.Shared.fill=!1,i.Total.color="coral",i.Total.width=1,i.Total.fill=!0,u.querySelector(".avearge-number").innerText=parseInt(l/c*100)+"%";var t=document.getElementById("graph_occupancy");let a=getParentByClass(t,"top");a.querySelector(".wait").classList.add("hidden");drawGraph("graph_occupancy",d,i,"line",ratio)}function callDashOccupancyByRooms(e){let t={};var a="occupancy_pie";let n=["rgba(255, 99, 132)","rgba(54, 162, 235)","rgba(255, 206, 86)","rgba(75, 192, 192)","rgba(153, 102, 255)","rgba(255, 159, 64)"],o=0;console.log(e),Array.from(Object.keys(e)).forEach(function(e){o<n.length&&(t[e]=n[o]),o++});var r=document.getElementById(a);let s=getParentByClass(r,"top"),d=s.querySelector(".wait");d.classList.add("hidden"),drawGraph(a,t,e,"doughnut",1.5)}function callDashEarningsDayByDay(a){var n,o=Date.parse(a.sd),e=Date.parse(a.ed);let r=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),s=[],d={Income:{datas:[]},Outgoings:{datas:[]},Earnings:{datas:[]}};var i=(e-o)/864e5+1;let l=document.getElementById("earnings-card"),c=0,u=0;for(let t=0;t<=i;t++){var y=o+864e5*t,g=([{value:y},,{value:n},,{value:g}]=r.formatToParts(y),g+"-"+y+"-"+n);s.push(y+"-"+n);let e=outgoings=0;a.incomes.hasOwnProperty(g)&&(e=a.incomes[g]),a.outgoings.hasOwnProperty(g)&&(outgoings=a.outgoings[g]);y=e-outgoings;g==today?(l.querySelector(".today-number").innerText=y,document.querySelector("#today_payments").innerText=e,document.querySelector("#today_outgoings").innerText=outgoings,document.querySelector("#today_earnings").innerText=y):g==yesterday&&(l.querySelector(".yesterday-number").innerText=y,document.querySelector("#yday_payments").innerText=e,document.querySelector("#yday_outgoings").innerText=outgoings,document.querySelector("#yday_earnings").innerText=y),c+=parseInt(y),u++,d.Income.datas[t]=e,d.Outgoings.datas[t]=outgoings,d.Earnings.datas[t]=y}d.Income.color="slategray",d.Income.width=2,d.Income.fill=!1,d.Outgoings.color="coral",d.Outgoings.width=2,d.Outgoings.fill=!1,d.Earnings.color="lime",d.Earnings.width=1,d.Earnings.fill=!0,c=parseInt(c/u),l.querySelector(".average-number").innerText=c;e=document.getElementById("graph_earnings");let t=getParentByClass(e,"top");t.querySelector(".wait").classList.add("hidden");drawGraph("graph_earnings",s,d,"line",ratio)}function callDashIncomingsByPaymentMethod(e){let t={};var a="graph_earnings_method";let n=["rgba(255, 99, 132)","rgba(54, 162, 235)","rgba(255, 206, 86)","rgba(75, 192, 192)","rgba(153, 102, 255)","rgba(255, 159, 64)"],o=0;Array.from(Object.keys(e)).forEach(function(e){o<n.length&&(t[e]=n[o]),o++});var r=document.getElementById(a);let s=getParentByClass(r,"top"),d=s.querySelector(".wait");o<1?d.innerHTML="<h4>Not enough datas</h4>":(d.classList.add("hidden"),drawGraph(a,t,e,"doughnut",1.5))}function callDashBookingsDayByDay(s){var e,t,a=Date.parse(s.sd),n=Date.parse(s.ed);let d=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),i=[],l={},c={0:"gray",1:"#00aae7",2:"green",8:"#0419a9",9:"purple"};Object.keys(mapBookingStates).forEach(function(e){var t;Object.keys(c).includes(e)&&(t=mapBookingStates[e],e=c[e],l[t]={datas:[],fill:!1,width:2,color:e})}),l.Total={datas:[],fill:!0,width:1,color:"lime"};var o=(n-a)/864e5+1;let u=document.getElementById("bookings_states"),y=0,g=0;for(let r=0;r<=o;r++){var m=a+864e5*r;[{value:m},,{value:e},,{value:t}]=d.formatToParts(m);let n=t+"-"+m+"-"+e,o=(i.push(m+"-"+e),0);Object.keys(mapBookingStates).forEach(function(t){if(Object.keys(c).includes(t)){var a=mapBookingStates[t];let e=0;s.hasOwnProperty(n)&&(e=s[n][t],isNaN(e)&&(e=0)),l[a].datas[r]=e,0!=t&&(o+=parseInt(e))}}),n==today?(u.querySelector(".today-number").innerText=o,document.querySelector("#today_new_bookings").innerText=o):n==yesterday&&(document.querySelector("#yday_new_bookings").innerText=o,u.querySelector(".yesterday-number").innerText=o),y+=parseInt(o),g++,l.Total.datas[r]=o}y=parseInt(y/g),u.querySelector(".average-number").innerText=y;n=document.getElementById("graph_bookings_states");let r=getParentByClass(n,"top");r.querySelector(".wait").classList.add("hidden");drawGraph("graph_bookings_states",i,l,"line",ratio)}function callDashBookingsChannels(e){let t={};var a="graph_bookings_channels";let n=["rgba(255, 99, 132)","rgba(54, 162, 235)","rgba(255, 206, 86)","rgba(75, 192, 192)","rgba(153, 102, 255)","rgba(255, 159, 64)"],o=0;Array.from(Object.keys(e)).forEach(function(e){o<n.length&&(t[e]=n[o]),o++});var r=document.getElementById(a);let s=getParentByClass(r,"top"),d=s.querySelector(".wait");o<3?d.innerHTML="<h4>Not enough datas</h4>":(d.classList.add("hidden"),drawGraph(a,t,e,"doughnut",1.5))}function callDashDueInvoices(e){let a=document.getElementById("dueinvoices_card_template"),n=document.getElementById("dueinvoices_cards_container"),t=document.getElementById("dueinvoices_count");for(var o=e.count;n.firstChild;)n.removeChild(n.firstChild);0==o?t.innerText="No Due Invoices":(t.innerText="Showing "+e.cards.length+" of "+e.count,Array.from(Object.values(e.cards)).forEach(function(e){console.log(e);let t=a.content.cloneNode(!0);t.querySelector("a").href="/workspace/booking.php?bid="+e.bid,t.querySelector("a").classList.add("st-"+e.state,"bg-st-"+e.state),t.querySelector(".due-name").innerText=e.name,t.querySelector(".due-state").innerText=booking_states[e.state],t.querySelector(".due-amount").innerText=e.balance,t.querySelector(".due-paied").innerText=e.paied,n.appendChild(t)}))}window.innerWidth<600&&(ratio=1.5);var lazyGraphs={graph_bookings_channels:{state:0,init:function(){getBookingsChannels("last_30_days")}},graph_bookings_states:{state:0,init:function(){getBookingsDayByDay("last_30_days")}},graph_occupancy:{state:0,init:function(){getOccupancyDayByDay()}},occupancy_pie:{state:0,init:function(){getOccupancyByRooms()}},graph_earnings_method:{state:0,init:function(){getIncomingsByPaymentMethod("last_30_days")}},graph_earnings:{state:0,init:function(){getEarningsDayByDay("last_30_days")}}};function scrollInitListener(){document.addEventListener("scroll",onScroll)}function onScroll(e){let a=0,n=window.innerHeight;Array.from(Object.keys(lazyGraphs)).forEach(function(e){let t=document.getElementById(e);e=t.id;t.getBoundingClientRect().bottom<n&&0==lazyGraphs[e].state&&(lazyGraphs[e].state=1,lazyGraphs[e].init()),1==lazyGraphs[e].state&&a++}),a==Object.keys(lazyGraphs).length&&document.removeEventListener("scroll",onScroll)}
