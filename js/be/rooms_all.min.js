function callRoomsDrawSchema(e){console.log(e);let s=document.querySelector("#room_card"),t=document.querySelector("#room_view_container"),i=t.querySelector("#room_view_container_shared"),c=t.querySelector("#room_view_container_privates");if(console.log("Rooms number "+Object.entries(e).length),0==Object.entries(e).length)return console.log("no rooms"),document.getElementById("no_rooms_msg").hidden=0,document.querySelector("#rooms_header_container").hidden=1,void(t.hidden=1);Array.from(Object.values(e)).forEach(function(e){var t,o=e[0],r=e[1],n=e[2],a=(e[3],e[4]),e=e[5];let l=s.content.cloneNode(!0);if(l.querySelector(".room-name").textContent=n,l.querySelector(".room-card-container").id="rid_"+o,l.querySelector(".room-size").textContent=a,l.querySelector(".room-free").textContent=a,1==(l.querySelector(".room-type").textContent=r)){l.querySelector(".room-card-center").href="#_";for(let e=1;e<=a;e++)t=(t="<li class='show-all-bookings-li' id='r"+o+"_b"+e+"'>")+"  \t<h3 class='bed-number'>"+e+"</h3>  \t<div class='grid-container gap2p name-container mobile-keep'>  \t\t<a class='left dorm-side hidden-forced'>     \t\t<h4 class='name'></h4>\t\t\t<div class='flex-container centered'>\t\t\t\t<img src='/assets/icons/inout.svg' class='filter-green ma hidden' height='8' width='8'>\t\t\t\t<h6 class='arrival_date'></h6>\t\t\t</div>\t\t\t<div class='flex-container centered'>\t\t\t\t<img src='/assets/icons/inout.svg' class='filter-red ma hidden' height='8' width='8'>\t\t\t\t<h6 class='leave_date'></h6>\t\t\t</div>  \t\t</a>  \t\t<a class='right dorm-side'>     \t\t<h4 class='name'>---</h4>\t\t\t<div class='flex-container centered'>\t\t\t\t<img src='/assets/icons/inout.svg' class='filter-green ma hidden' height='8' width='8'>\t\t\t\t<h6 class='arrival_date'></h6>\t\t\t</div>\t\t\t<div class='flex-container centered'>\t\t\t\t<img src='/assets/icons/inout.svg' class='filter-red ma hidden' height='8' width='8'>\t\t\t\t<h6 class='leave_date'></h6>\t\t\t</div>  \t\t</a>\t</div></li>",t=parseHTML(t),l.querySelector(".show-all-bookings ul").appendChild(t)}n="/assets/icons/"+roomsCatImg(e);l.querySelector(".img-room-cat").src=n,(0==r?c:i).appendChild(l)});let o;0==c.childNodes.length&&(o=getParentByClass(c,"rooms-card-container")).classList.add("hidden"),0==i.childNodes.length&&(o=getParentByClass(i,"rooms-card-container")).classList.add("hidden"),roomsDateSelector()}function callRoomsRetrieveBookings(e){console.log(e);let s,i,c,d,m,u,t,o,y,g,h,S={};let r=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),n=new Date;var a=n.getHours();let f=n.getTime();var[{value:l},,{value:p},,{value:q}]=r.formatToParts(n),q=q+"-"+l+"-"+p,l=Math.floor((pageCenterDate-f)/1e3/3600/24)+1;console.log("hour now: "+a+"; timeNow: "+f+"; today: "+q+"; cd Diff: "+l),Array.from(Object.values(e)).forEach(function(n){if(console.log(n),!n.hasOwnProperty("num")&&(c=n[0],t=n[1],s=n[2],i=n[3],d=n[4],o=n[5],m=n[6],u=n[7],cstate=n[8],tid=n[9],100!=t&&0!=d)){let e=!0;var n=Math.floor((milliSecondsFromString(u)-pageCenterDate)/1e3/3600/24)+1,a=Math.floor((milliSecondsFromString(m)-pageCenterDate)/1e3/3600/24);Math.floor((milliSecondsFromString(u)-f)/1e3/3600/24),Math.floor((milliSecondsFromString(m)-f)/1e3/3600/24);y=document.querySelector("#rid_"+i),g=y.firstElementChild,h=g.querySelector(".room-type").innerText,0==n&&(e=!1);let t=new Intl.DateTimeFormat("en",{month:"short",day:"2-digit"}),o=new Date;var l=m.split(/\D/);o.setYear(l[0]),o.setMonth(l[1]-1),o.setDate(l[2]),[{value:sdmonth},,{value:sdday}]=t.formatToParts(o);let r=new Date;l=u.split(/\D/);if(r.setYear(l[0]),r.setMonth(l[1]-1),r.setDate(parseInt(l[2])+1),[{value:edmonth},,{value:edday}]=t.formatToParts(r),0==h){let e,t=(0==n?((e=g.querySelector(".room-card-name-l")).classList.remove("hidden"),e.parentElement.classList.add("grid-2col")):e=g.querySelector(".room-card-name-r"),e.href="/workspace/booking.php?bid="+s,e.querySelector(".booking-name").innerText=c,e.querySelector(".booking-name").classList.add("st-"+cstate),e.querySelector(".booking-add").classList.add("hidden"),e.querySelector(".booking-add").classList.remove("flex-centered"),"");t=0==n?9==cstate?"Checked out this day":"Will checkout out this day":1==n?"Will Checkout day after":"Will checkout in "+n+" days",e.querySelector(".checkout-info").innerText=t,e.querySelector(".arrival_date").innerText=sdday+" "+sdmonth,e.querySelector(".leave_date").innerText=edday+" "+edmonth,e.querySelector(".inout-dates").classList.remove("hidden")}else{let e,t=y.querySelector("#r"+i+"_b"+d);0==n?((e=t.querySelector(".left")).classList.remove("hidden-forced"),e.parentElement.classList.add("grid-2col")):0==a?(e=t.querySelector(".right"),t.querySelector(".left").classList.remove("hidden-forced"),e.parentElement.classList.add("grid-2col")):e=t.querySelector(".right"),e.querySelectorAll("img").forEach(function(e){e.classList.remove("hidden")}),e.href="/workspace/booking.php?bid="+s,e.classList.add("bg-st-"+cstate),e.querySelector(".name").innerText=c,e.querySelector(".name").classList.add("st-"+cstate),e.querySelector(".arrival_date").innerText=sdday+" "+sdmonth,e.querySelector(".leave_date").innerText=edday+" "+edmonth}e&&(S.hasOwnProperty(i)?S[i]=parseInt(S[i])+1:S[i]=1)}}),console.log("Occupancy array"),console.log(S),Array.from(Object.entries(S)).forEach(function([e,t]){y=document.querySelector("#rid_"+e),g=y.firstElementChild,h=g.querySelector(".room-type").innerText,0!=t.length&&!isNaN(t)||(t=0);var o=parseInt(y.querySelector(".room-size").innerText),r=o-t,o=parseInt(t/o*100);g.querySelector(".room-occupancy").innerText=o,g.querySelector(".room-free").innerText=r,g.querySelector(".room-guests").innerText=t,setRoomColor(o,e)}),controlsEnable()}function roomsDrawSchema(){let e;for(e=document.getElementById("room_view_container_privates");e.firstChild;)e.removeChild(e.firstChild);for(e=document.getElementById("room_view_container_shared");e.firstChild;)e.removeChild(e.firstChild);postHttpReq("rooms_schema_get")}function roomsDateSelector(e){let t=document.getElementById("room_date_selector");new Date;let o=new Date;0==arguments.length?void 0!==(r=getCookie("centerDate"))&&!isNaN(r)&&0<r.length&&(console.log("cookieCenterDate found: "+r),o.setTime(r)):o.setTime(e);var r=o.toLocaleString("default",{month:"long"}),n=o.toLocaleString("default",{weekday:"long"}),a=o.getTime();pageCenterDate=a,t.querySelector(".l").innerText=o.getDate(),t.querySelector(".rt").innerText=r,t.querySelector(".rb").innerText=n,setCookie("centerDate",pageCenterDate,.0035),retrieveBookings(a)}function retrieveBookings(e){var t;new Date;let o=new Date,r=new Date;0==arguments.length?void 0!==(t=getCookie("centerDate"))&&!isNaN(t)&&0<t.length&&(console.log("cookieCenterDate found: "+t),o.setTime(t)):o.setTime(e),r.setTime(o.getTime()-864e5),console.log("yesterday date "+r+".. getmonth "+r.getMonth()),e=o.getFullYear()+"-"+String(parseInt(o.getMonth())+1).padStart(2,"0")+"-"+String(parseInt(o.getDate())).padStart(2,"0"),centerDateLess=r.getFullYear()+"-"+String(parseInt(r.getMonth())+1).padStart(2,"0")+"-"+String(parseInt(r.getDate())).padStart(2,"0"),console.log(e+" ---- "+centerDateLess),arr="&d="+centerDateLess+","+e,postHttpReq("rooms_retrieve_bookings",arr)}function roomsCalGoToday(){let e=new Date;e.setTime(todayG.getTime()),setAllRoomsEmpty(),roomsDateSelector(e)}function roomsCalClick(e){console.log(e),setCookie("centerDate",e.getTime(),.0035),setAllRoomsEmpty(),roomsDateSelector(e)}function roomsDateSelectorNext(e){e.disabled||(document.getElementById("room_date_selector"),e=parseInt(pageCenterDate),e+=864e5,setAllRoomsEmpty(),roomsDateSelector(e))}function roomsDateSelectorPrev(e){e.disabled||(document.getElementById("room_date_selector"),e=parseInt(pageCenterDate),e-=864e5,setAllRoomsEmpty(),roomsDateSelector(e))}function setAllRoomsEmpty(){document.querySelectorAll(".room-card-container").forEach(function(e){setRoomEmpty(e.id.split("_")[1])})}function setRoomEmpty(e){let t=document.querySelector("#rid_"+e),o=t.firstElementChild;o.querySelector(".room-type").innerText;var r=parseInt(o.querySelector(".room-size").innerText);o.querySelector(".names-part").classList.remove("grid-2col"),o.querySelector(".room-card-name-l").classList.add("hidden"),o.querySelector(".names-part").querySelectorAll("a").forEach(function(e){e.querySelector(".inout-dates").classList.add("hidden"),e.querySelector(".booking-name").className="booking-name m0",e.querySelector(".booking-name").innerText="",e.querySelector(".booking-add").classList.remove("hidden"),e.querySelector(".booking-add").classList.add("flex-centered"),e.querySelector(".checkout-info").innerText="",e.href="#_"}),o.querySelector(".room-occupancy").innerText="0",o.querySelector(".room-free").innerText=r,o.querySelector(".room-guests").innerText="0",t.querySelectorAll(".show-all-bookings-li").forEach(function(e){e.querySelector(".name-container").classList.remove("grid-2col"),e.querySelector(".left").classList.add("hidden-forced"),e.querySelectorAll(".dorm-side").forEach(function(e){e.href="",e.classList.remove("bg-st-1","bg-st-2","bg-st-5","bg-st-8","bg-st-9"),e.querySelector(".name").innerText="---",e.querySelector(".name").classList.remove("st-0","st-1","st-2","st-5","st-7","st-8","st-9"),e.querySelector(".arrival_date").innerText="",e.querySelector(".leave_date").innerText="",e.querySelectorAll("img").forEach(function(e){e.classList.add("hidden")})})}),setRoomColor(0,e)}function setRoomColor(e,t){let o=document.querySelector("#rid_"+t).firstElementChild;t=o.querySelector(".room-type").innerText;["room-empty","room-half-full","room-almost-full","room-full"].forEach(function(e){o.classList.remove(e)}),0==t&&0<e?(o.classList.remove("room-empty"),o.classList.add("room-full")):e<40?o.classList.add("room-empty"):e<75?(o.classList.remove("room-empty"),o.classList.add("room-half-full")):e<100?(o.classList.remove("room-empty"),o.classList.add("room-almost-full")):100==e&&(o.classList.remove("room-empty"),o.classList.add("room-full"))}function controlsDisable(){document.getElementById("rooms_header_container").querySelectorAll("a").forEach(function(e){e.disabled=!0,e.classList.add("disabled"),e.classList.add("tlgray"),e.classList.remove("tcoral")})}function controlsEnable(){document.getElementById("rooms_header_container").querySelectorAll("a").forEach(function(e){e.classList.remove("disabled"),e.disabled=!1,e.classList.remove("tlgray"),e.classList.add("tcoral")})}function roomsShowAllBookings(e){let t=getParentByClass(e,"room-card-container");e=t.id.split("_")[1];if(0==t.querySelector(".room-type").innerText)return!1;t.querySelector(".show-all-bookings").classList.toggle("hidden"),console.log(e)}function bookingAdd(e){let t=new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit"}),o=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),r=new Date;r.setTime(pageCenterDate),[{value:month},,{value:day},,{value:year}]=o.formatToParts(r);var n=year+"-"+month+"-"+day;[{value:month},,{value:day},,{value:year}]=t.formatToParts(r);let a=getParentByClass(e,"room-card-container");var e=a.id.split("_")[1],l=a.querySelector(".room-type").innerText,s=parseInt(a.querySelector(".room-size").innerText),i=a.querySelector(".img-room-cat").src,c=a.querySelector(".room-name").innerText;if(0==a.querySelector(".room-free").innerText)return showMessage(!1,"Room "+c+" is full"),!1;console.log("rid: "+e+"; rtype: "+l+"; size: "+s+"; sd: "+n),showPopup("popup_rooms_booking_add");let d=document.getElementById("popup_rooms_booking_add"),m=d.querySelector(".book-start-date"),u=(m.querySelector(".day").innerText=day,m.querySelector(".month").innerText=month,m.querySelector(".dow").innerText=dow_long[r.getDay()],d.querySelector(".room-name").innerText=c,d.querySelector(".img-room-cat").src=i,0);u=0==l?s:2,d.querySelector(".tot-guests").innerText=u,d.querySelector(".tot-nights").innerText=1,bookingAddNights(0),d.querySelector('input[name="rid"]').value=e,d.querySelector('input[name="rtype"]').value=l,d.querySelector('input[name="max_size"]').value=s,d.querySelector('input[name="sd"]').value=n,d.querySelector('input[name="guests"]').value=u}function bookingAddNights(r){console.log("adding night "+r);let n=new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit"}),a=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),l=document.getElementById("popup_rooms_booking_add");r=parseInt(l.querySelector(".tot-nights").innerText)+r;if(0!=r){l.querySelector(".tot-nights").innerText=r;var s=pageCenterDate+3600*r*24*1e3;let e=new Date,t=(e.setTime(s),new Date);t.setTime(s-864e5),[{value:month},,{value:day},,{value:year}]=a.formatToParts(t);s=year+"-"+month+"-"+day;[{value:month},,{value:day},,{value:year}]=n.formatToParts(e);let o=l.querySelector(".book-end-date");o.querySelector(".day").innerText=day,o.querySelector(".month").innerText=month,o.querySelector(".dow").innerText=dow_long[e.getDay()],l.querySelector('input[name="ed"]').value=s,l.querySelector('input[name="nights"]').value=r}}function bookingAddGuests(e){let t=document.getElementById("popup_rooms_booking_add");var o=t.querySelector('input[name="max_size"]').value,r=parseInt(t.querySelector(".tot-guests").innerText);0==(r+=e)||o<r||(t.querySelector(".tot-guests").innerText=r,t.querySelector('input[name="guests"]').value=r)}function holdit(e,t,o,r){function n(){t(),a=setTimeout(n,o),(o/=r)<50&&(o=50)}var a,l=o;e.onmousedown=function(e){e.preventDefault(),n()},e.onmouseup=function(e){clearTimeout(a),o=l},e.onmouseout=e.onmouseup,e.ontouchstart=e.onmousedown,e.ontouchend=e.onmouseup}
