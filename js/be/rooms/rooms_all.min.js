function callRoomsDrawSchema(e){console.log(e);let t=document.querySelector("#room_card"),o=document.querySelector("#room_view_container"),r=o.querySelector("#room_view_container_shared"),n=o.querySelector("#room_view_container_privates");if(console.log("Rooms number "+Object.entries(e).length),0==Object.entries(e).length){console.log("no rooms"),document.getElementById("no_rooms_msg").hidden=0,document.querySelector("#rooms_header_container").hidden=1,o.hidden=1;return}Array.from(Object.values(e)).forEach(function(e){let o=e[0],l=e[1],i=e[2];e[3];let a=e[4],s=e[5],c=t.content.cloneNode(!0);if(c.querySelector(".room-name").textContent=i,c.querySelector(".room-card-container").id="rid_"+o,c.querySelector(".room-size").textContent=a,c.querySelector(".room-free").textContent=a,c.querySelector(".room-type").textContent=l,1==l){c.querySelector(".room-card-center").href="#_";let d;for(let m=1;m<=a;m++)d="<li class='show-all-bookings-li' id='r"+o+"_b"+m+"'>",d+="  	<h3 class='bed-number'>"+m+"</h3>",d+="  	<div class='grid-container gap2p name-container mobile-keep'>",d+="  		<a class='left dorm-side hidden-forced'>",d+="     		<h4 class='name'></h4>",d+="			<div class='flex-container centered'>",d+="				<img src='/assets/be/icons/inout.svg' class='filter-green ma hidden' height='8' width='8'>",d+="				<h6 class='arrival_date'></h6>",d+="			</div>",d+="			<div class='flex-container centered'>",d+="				<img src='/assets/be/icons/inout.svg' class='filter-red ma hidden' height='8' width='8'>",d+="				<h6 class='leave_date'></h6>",d+="			</div>",d+="  		</a>",d+="  		<a class='right dorm-side'>",d+="     		<h4 class='name'>---</h4>",d+="			<div class='flex-container centered'>",d+="				<img src='/assets/be/icons/inout.svg' class='filter-green ma hidden' height='8' width='8'>",d+="				<h6 class='arrival_date'></h6>",d+="			</div>",d+="			<div class='flex-container centered'>",d+="				<img src='/assets/be/icons/inout.svg' class='filter-red ma hidden' height='8' width='8'>",d+="				<h6 class='leave_date'></h6>",d+="			</div>",d+="  		</a>",d+="	</div>",d+="</li>",d=parseHTML(d),c.querySelector(".show-all-bookings ul").appendChild(d)}let u=roomsCatImg(s);c.querySelector(".img-room-cat").src="/assets/be/icons/"+u,0==l?n.appendChild(c):r.appendChild(c)});let l;0==n.childNodes.length&&(l=getParentByClass(n,"rooms-card-container")).classList.add("hidden"),0==r.childNodes.length&&(l=getParentByClass(r,"rooms-card-container")).classList.add("hidden"),roomsDateSelector()}function callRoomsRetrieveBookings(e){console.log(e);let t,o,r,n,l,i,a,s,c,d,m,u={},y=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit"}),g=new Date,h=g.getHours(),f=g.getTime(),[{value:S},,{value:q},,{value:$}]=y.formatToParts(g),v=Math.floor((pageCenterDate-f)/1e3/3600/24)+1;console.log("hour now: "+h+"; timeNow: "+f+"; today: "+($+"-"+S)+"-"+q+"; cd Diff: "+v),Array.from(Object.values(e)).forEach(function(e){if(console.log(e),e.hasOwnProperty("num")||(r=e[0],a=e[1],t=e[2],o=e[3],n=e[4],s=e[5],l=e[6],i=e[7],cstate=e[8],tid=e[9],100==a||0==n))return;let y=!0,g=Math.floor((milliSecondsFromString(i)-pageCenterDate)/1e3/3600/24)+1,h=Math.floor((milliSecondsFromString(l)-pageCenterDate)/1e3/3600/24);milliSecondsFromString(i),milliSecondsFromString(l),m=(d=(c=document.querySelector("#rid_"+o)).firstElementChild).querySelector(".room-type").innerText,0==g&&(y=!1);let f=new Intl.DateTimeFormat("en",{month:"short",day:"2-digit"}),S=new Date,q=l.split(/\D/);S.setYear(q[0]),S.setMonth(q[1]-1),S.setDate(q[2]),[{value:sdmonth},,{value:sdday}]=f.formatToParts(S);let $=new Date,v=i.split(/\D/);if($.setYear(v[0]),$.setMonth(v[1]-1),$.setDate(parseInt(v[2])+1),[{value:edmonth},,{value:edday}]=f.formatToParts($),0==m){let p;0==g?((p=d.querySelector(".room-card-name-l")).classList.remove("hidden"),p.parentElement.classList.add("grid-2col")):p=d.querySelector(".room-card-name-r"),p.href="/workspace/booking.php?bid="+t,p.querySelector(".booking-name").innerText=r,p.querySelector(".booking-name").classList.add("st-"+cstate),p.querySelector(".booking-add").classList.add("hidden"),p.querySelector(".booking-add").classList.remove("flex-centered");let T="";T=0==g?9==cstate?"Checked out this day":"Will checkout out this day":1==g?"Will Checkout day after":"Will checkout in "+g+" days",p.querySelector(".checkout-info").innerText=T,p.querySelector(".arrival_date").innerText=sdday+" "+sdmonth,p.querySelector(".leave_date").innerText=edday+" "+edmonth,p.querySelector(".inout-dates").classList.remove("hidden")}else{let x,b=c.querySelector("#r"+o+"_b"+n);0==g?((x=b.querySelector(".left")).classList.remove("hidden-forced"),x.parentElement.classList.add("grid-2col")):0==h?(x=b.querySelector(".right"),b.querySelector(".left").classList.remove("hidden-forced"),x.parentElement.classList.add("grid-2col")):x=b.querySelector(".right"),x.querySelectorAll("img").forEach(function(e){e.classList.remove("hidden")}),x.href="/workspace/booking.php?bid="+t,x.classList.add("bg-st-"+cstate),x.querySelector(".name").innerText=r,x.querySelector(".name").classList.add("st-"+cstate),x.querySelector(".arrival_date").innerText=sdday+" "+sdmonth,x.querySelector(".leave_date").innerText=edday+" "+edmonth}y&&(u.hasOwnProperty(o)?u[o]=parseInt(u[o])+1:u[o]=1)}),console.log("Occupancy array"),console.log(u),Array.from(Object.entries(u)).forEach(function([e,t]){m=(d=(c=document.querySelector("#rid_"+e)).firstElementChild).querySelector(".room-type").innerText,(0==t.length||isNaN(t))&&(t=0);let o=parseInt(c.querySelector(".room-size").innerText),r=o-t,n=parseInt(t/o*100);d.querySelector(".room-occupancy").innerText=n,d.querySelector(".room-free").innerText=r,d.querySelector(".room-guests").innerText=t,setRoomColor(n,e)}),controlsEnable()}function roomsDrawSchema(){let e;for(e=document.getElementById("room_view_container_privates");e.firstChild;)e.removeChild(e.firstChild);for(e=document.getElementById("room_view_container_shared");e.firstChild;)e.removeChild(e.firstChild);postHttpReq("rooms_schema_get")}function roomsDateSelector(e){let t=document.getElementById("room_date_selector"),o=new Date;if(0==arguments.length){let r=getCookie("centerDate");void 0!==r&&!isNaN(r)&&r.length>0&&(console.log("cookieCenterDate found: "+r),o.setTime(r))}else o.setTime(e);let n=o.toLocaleString("default",{month:"long"}),l=o.toLocaleString("default",{weekday:"long"}),i=o.getTime();pageCenterDate=i,t.querySelector(".l").innerText=o.getDate(),t.querySelector(".rt").innerText=n,t.querySelector(".rb").innerText=l,setCookie("centerDate",pageCenterDate,.0035),retrieveBookings(i)}function retrieveBookings(e){let t=new Date,o=new Date;if(0==arguments.length){let r=getCookie("centerDate");void 0!==r&&!isNaN(r)&&r.length>0&&(console.log("cookieCenterDate found: "+r),t.setTime(r))}else t.setTime(e);o.setTime(t.getTime()-864e5),console.log("yesterday date "+o+".. getmonth "+o.getMonth()),e=t.getFullYear()+"-"+String(parseInt(t.getMonth())+1).padStart(2,"0")+"-"+String(parseInt(t.getDate())).padStart(2,"0"),centerDateLess=o.getFullYear()+"-"+String(parseInt(o.getMonth())+1).padStart(2,"0")+"-"+String(parseInt(o.getDate())).padStart(2,"0"),console.log(e+" ---- "+centerDateLess),postHttpReq("rooms_retrieve_bookings",arr="&d="+centerDateLess+","+e)}function roomsCalGoToday(){let e=new Date;e.setTime(todayG.getTime()),setAllRoomsEmpty(),roomsDateSelector(e)}function roomsCalClick(e){console.log(e),setCookie("centerDate",e.getTime(),.0035),setAllRoomsEmpty(),roomsDateSelector(e)}function roomsDateSelectorNext(e){if(e.disabled)return;document.getElementById("room_date_selector");let t=parseInt(pageCenterDate);t+=864e5,setAllRoomsEmpty(),roomsDateSelector(t)}function roomsDateSelectorPrev(e){if(e.disabled)return;document.getElementById("room_date_selector");let t=parseInt(pageCenterDate);t-=864e5,setAllRoomsEmpty(),roomsDateSelector(t)}function setAllRoomsEmpty(){document.querySelectorAll(".room-card-container").forEach(function(e){setRoomEmpty(e.id.split("_")[1])})}function setRoomEmpty(e){let t=document.querySelector("#rid_"+e),o=t.firstElementChild;o.querySelector(".room-type").innerText;let r=parseInt(o.querySelector(".room-size").innerText);o.querySelector(".names-part").classList.remove("grid-2col"),o.querySelector(".room-card-name-l").classList.add("hidden"),o.querySelector(".names-part").querySelectorAll("a").forEach(function(e){e.querySelector(".inout-dates").classList.add("hidden"),e.querySelector(".booking-name").className="booking-name m0",e.querySelector(".booking-name").innerText="",e.querySelector(".booking-add").classList.remove("hidden"),e.querySelector(".booking-add").classList.add("flex-centered"),e.querySelector(".checkout-info").innerText="",e.href="#_"}),o.querySelector(".room-occupancy").innerText="0",o.querySelector(".room-free").innerText=r,o.querySelector(".room-guests").innerText="0",t.querySelectorAll(".show-all-bookings-li").forEach(function(e){e.querySelector(".name-container").classList.remove("grid-2col"),e.querySelector(".left").classList.add("hidden-forced"),e.querySelectorAll(".dorm-side").forEach(function(e){e.href="",e.classList.remove("bg-st-1","bg-st-2","bg-st-5","bg-st-8","bg-st-9"),e.querySelector(".name").innerText="---",e.querySelector(".name").classList.remove("st-0","st-1","st-2","st-5","st-7","st-8","st-9"),e.querySelector(".arrival_date").innerText="",e.querySelector(".leave_date").innerText="",e.querySelectorAll("img").forEach(function(e){e.classList.add("hidden")})})}),setRoomColor(0,e)}function setRoomColor(e,t){let o=document.querySelector("#rid_"+t).firstElementChild,r=o.querySelector(".room-type").innerText;["room-empty","room-half-full","room-almost-full","room-full"].forEach(function(e){o.classList.remove(e)}),0==r&&e>0?(o.classList.remove("room-empty"),o.classList.add("room-full")):e<40?o.classList.add("room-empty"):e<75?(o.classList.remove("room-empty"),o.classList.add("room-half-full")):e<100?(o.classList.remove("room-empty"),o.classList.add("room-almost-full")):100==e&&(o.classList.remove("room-empty"),o.classList.add("room-full"))}function controlsDisable(){document.getElementById("rooms_header_container").querySelectorAll("a").forEach(function(e){e.disabled=!0,e.classList.add("disabled"),e.classList.add("tlgray"),e.classList.remove("tcoral")})}function controlsEnable(){document.getElementById("rooms_header_container").querySelectorAll("a").forEach(function(e){e.classList.remove("disabled"),e.disabled=!1,e.classList.remove("tlgray"),e.classList.add("tcoral")})}function roomsShowAllBookings(e){let t=getParentByClass(e,"room-card-container"),o=t.id.split("_")[1];if(0==t.querySelector(".room-type").innerText)return!1;t.querySelector(".show-all-bookings").classList.toggle("hidden"),console.log(o)}function bookingAdd(e){let t=new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit"}),o=new Intl.DateTimeFormat("en",{year:"numeric",month:"numeric",month:"2-digit",day:"2-digit"}),r=new Date;r.setTime(pageCenterDate),[{value:month},,{value:day},,{value:year}]=o.formatToParts(r);let n=year+"-"+month+"-"+day;[{value:month},,{value:day},,{value:year}]=t.formatToParts(r);let l=getParentByClass(e,"room-card-container"),i=l.id.split("_")[1],a=l.querySelector(".room-type").innerText,s=parseInt(l.querySelector(".room-size").innerText),c=l.querySelector(".img-room-cat").src,d=l.querySelector(".room-name").innerText;if(0==l.querySelector(".room-free").innerText)return showMessage(!1,"Room "+d+" is full"),!1;console.log("rid: "+i+"; rtype: "+a+"; size: "+s+"; sd: "+n),showPopup("popup_rooms_booking_add");let m=document.getElementById("popup_rooms_booking_add"),u=m.querySelector(".book-start-date");u.querySelector(".day").innerText=day,u.querySelector(".month").innerText=month,u.querySelector(".dow").innerText=dow_long[r.getDay()],m.querySelector(".room-name").innerText=d,m.querySelector(".img-room-cat").src=c;let y=0;y=0==a?s:2,m.querySelector(".tot-guests").innerText=y,m.querySelector(".tot-nights").innerText=1,bookingAddNights(0),m.querySelector('input[name="rid"]').value=i,m.querySelector('input[name="rtype"]').value=a,m.querySelector('input[name="max_size"]').value=s,m.querySelector('input[name="sd"]').value=n,m.querySelector('input[name="guests"]').value=y}function bookingAddNights(e){console.log("adding night "+e);let t=new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit"}),o=new Intl.DateTimeFormat("en",{year:"numeric",month:"numeric",month:"2-digit",day:"2-digit"}),r=document.getElementById("popup_rooms_booking_add"),n=parseInt(r.querySelector(".tot-nights").innerText)+e;if(0==n)return;r.querySelector(".tot-nights").innerText=n;let l=pageCenterDate+864e5*n,i=new Date;i.setTime(l);let a=new Date;a.setTime(l-864e5),[{value:month},,{value:day},,{value:year}]=o.formatToParts(a);let s=year+"-"+month+"-"+day;[{value:month},,{value:day},,{value:year}]=t.formatToParts(i);let c=r.querySelector(".book-end-date");c.querySelector(".day").innerText=day,c.querySelector(".month").innerText=month,c.querySelector(".dow").innerText=dow_long[i.getDay()],r.querySelector('input[name="ed"]').value=s,r.querySelector('input[name="nights"]').value=n}function bookingAddGuests(e){let t=document.getElementById("popup_rooms_booking_add"),o=t.querySelector('input[name="max_size"]').value,r=parseInt(t.querySelector(".tot-guests").innerText);0==(r+=e)||r>o||(t.querySelector(".tot-guests").innerText=r,t.querySelector('input[name="guests"]').value=r)}function holdit(e,t,o,r){var n,l=o,i=function(){t(),n=setTimeout(i,o),(o/=r)<50&&(o=50)};e.onmousedown=function(e){e.preventDefault(),i()},e.onmouseup=function(e){clearTimeout(n),o=l},e.onmouseout=e.onmouseup,e.ontouchstart=e.onmousedown,e.ontouchend=e.onmouseup}