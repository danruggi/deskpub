var refs={};function processFile(i){i&&("undefined"!=typeof bid&&setCookie("booking_file_upload",bid,1),uploadImageControl("showProgress"),refs.messageBox.innerHTML="Converting..",new Promise(function(e,s){let o=new Image;o.addEventListener("load",function(){e(o)}),o.src=URL.createObjectURL(i)}).then(function(d){return new Promise(function(s,e){let o=document.createElement("canvas"),i=o.getContext("2d"),r=d.width,t=d.height,n=0;var a=1e3;refs.messageBox.innerHTML="Resizing..",(d.width>a||d.height>a)&&(d.width>=d.height?(r=a,n=d.width/a,t=d.height/n):(t=a,n=d.height/a,r=d.width/n)),console.log(d.width+" "+d.height+">>>"+r+" "+t),o.width=r,o.height=t,i.fillStyle="#fff",i.drawImage(d,0,0,r,t),refs.messageBox.innerHTML="Converting..",o.toBlob(function(e){s(URL.createObjectURL(e)),fetch("/servers/bookingImgUpload.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.hasOwnProperty("e")?(showMessage(!1,e.m,3),uploadImageControl("showUploadMethods")):(uploadImageControl("hideProgress"),location.pathname.includes("phoneUpload")&&(refs.messageBox.innerHTML="<h3>File Uploaded!</h3><h3>You can close this page</h3>"),showMessage(!0,e.m,3))}),console.log(e),console.log(e.type)},"image/jpeg")})}).then(function(i){return new Promise(function(e,s){let o=new Image;refs.messageBox.innerHTML="Scaling..",o.addEventListener("load",function(){e({imageURL:i,scaledImg:o})}),o.setAttribute("src",i)})}).then(function(e){refs.messageBox.innerHTML="Uploading..",refs.imageBox.classList.remove("hidden"),refs.imageBox.style.backgroundImage="url("+e.imageURL+")",booking_file_name=e.imageURL}))}function fileSelectorChanged(){processFile(refs.fileSelector.files[0]),refs.fileSelector.value=""}function fileSelectorClick(){refs.fileSelector.click()}function uploadImageControl(e,s){"showProgress"==e?(refs.imagePreviews.classList.remove("hidden"),refs.progressBox.classList.remove("hidden"),refs.imageBox.classList.add("hidden"),refs.divUploadsMethods.classList.add("hidden")):"showUploadMethods"==e?(refs.imagePreviews.classList.add("hidden"),refs.imageBox.classList.add("hidden"),refs.progressBox.classList.add("hidden"),refs.imageBox.style.backgroundImage="",refs.divUploadsMethods.classList.remove("hidden"),generateNewQrCodeFileUpload()):"hideProgress"==e?(refs.progressBox.classList.add("hidden"),refs.messageBox.innerHTML=""):"showPreview"==e&&(refs.imagePreviews.classList.remove("hidden"),refs.divUploadsMethods.classList.add("hidden"),refs.imageBox.classList.remove("hidden"),refs.imageBox.style.backgroundImage="url("+s+")")}refs.imagePreviews=document.querySelector("#previews"),refs.fileSelector=document.querySelector("input[type=file]"),refs.divUploadsMethods=document.querySelector("#upload_file_methods"),null!=refs.imagePreviews&&(refs.imageBox=refs.imagePreviews.querySelector("div.image"),refs.progressBox=refs.imagePreviews.querySelector("progress"),refs.messageBox=refs.imagePreviews.querySelector("span.message"),refs.fileSelector.addEventListener("change",fileSelectorChanged));
