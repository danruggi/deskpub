function getTopDashboardDatas(e,t){0==arguments.length&&(e=document.querySelector(".a-selectors button.default"),t="today");document.getElementById("section-one").querySelectorAll(".a-selectors button").forEach(function(e){e.classList.add("lgray"),e.classList.remove("green"),e.disabled=1}),e.classList.remove("lgray"),e.classList.add("green"),sded=sdEdFromString(t);let a=new FormData;a.append("q","dashboard_top_datas"),a.append("sd",sded[0]),a.append("ed",sded[1]),postFetch(a)}function getTopDashboardTodayChekinsOut(){let e=new FormData;e.append("q","dashboard_today_checkins_checkouts"),postFetch(e)}function getOccupancy(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_occupancy_timeframe"),t.append("sd",sded[0]),t.append("ed",sded[1])}function getOccupancyDayByDay(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_occupancy_by_days"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getOccupancyByRooms(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_occupancy_by_rooms"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getEarningsDayByDay(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_earnings_by_days"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getIncomingsByPaymentMethod(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_incomings_by_payment_method"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getBookingsDayByDay(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_bookings_by_days"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function getBookingsChannels(e){sded=sdEdFromString(e);let t=new FormData;t.append("q","dashboard_bookings_channels"),t.append("sd",sded[0]),t.append("ed",sded[1]),postFetch(t)}function sdEdFromString(e){let t,a="",n=[],r="",o,s,i,l=new Intl.DateTimeFormat("en",{year:"numeric",month:"numeric",month:"2-digit",day:"2-digit"}),d=new Date,c=d.getMonth(),u=d.getFullYear();if(d.getDate(),"today"==e)[{value:s},,{value:o},,{value:i}]=l.formatToParts(d),t=a=i+"-"+s+"-"+o;else if("yesterday"==e)d.setTime(d.getTime()-864e5),[{value:s},,{value:o},,{value:i}]=l.formatToParts(d),t=a=i+"-"+s+"-"+o;else if("last_week"==e)[{value:s},,{value:o},,{value:i}]=l.formatToParts(d),a=i+"-"+s+"-"+o,d.setTime(d.getTime()-5184e5),[{value:s},,{value:o},,{value:i}]=l.formatToParts(d),t=i+"-"+s+"-"+o;else if("last_30_days"==e)[{value:s},,{value:o},,{value:i}]=l.formatToParts(d),a=i+"-"+s+"-"+o,d.setTime(d.getTime()-2592e6),[{value:s},,{value:o},,{value:i}]=l.formatToParts(d),t=i+"-"+s+"-"+o;else if("current_year"==e)a=u+"-12-31",t=u+"-01-01";else if("last_year"==e)a=u-1+"-12-31",t=u-1+"-01-01";else if("last_month"==e)r=new Date(u,c,0),[{value:s},,{value:o},,{value:i}]=l.formatToParts(r),a=i+"-"+s+"-"+o,t=i+"-"+s+"-01";else if("this_month"==e)r=new Date(u,c+1,0),[{value:s},,{value:o},,{value:i}]=l.formatToParts(r),a=i+"-"+s+"-"+o,t=i+"-"+s+"-01";else if("ever"==e)a="2125-12-31",t="2020-01-01";else{let y=new Date;y.setTime(parseInt(d.getTime())-1296e6),[{value:s},,{value:o},,{value:i}]=l.formatToParts(y),t=i+"-"+s+"-"+o,y.setTime(1*d.getTime()+1296e6),[{value:s},,{value:o},,{value:i}]=l.formatToParts(y),a=i+"-"+s+"-"+o}return[t,a]}function setTodayTomorrowYesterday(){let e=new Date;format=new Intl.DateTimeFormat("en",{year:"numeric",month:"numeric",month:"2-digit",day:"2-digit"}),[{value:month},,{value:day},,{value:year}]=format.formatToParts(e),today=year+"-"+month+"-"+day,console.log("today set to "+today),e.setTime(e.getTime()+864e5),[{value:month},,{value:day},,{value:year}]=format.formatToParts(e),tomorrow=year+"-"+month+"-"+day,e.setTime(e.getTime()-1728e5),[{value:month},,{value:day},,{value:year}]=format.formatToParts(e),yesterday=year+"-"+month+"-"+day}function getDueInvoices(e,t){null==e&&(e=document.getElementById("due_8"));e.parentElement.children.forEach(function(t){t==e?(t.classList.add("green"),t.classList.remove("tlgray")):(t.classList.remove("green"),t.classList.add("tlgray"))});let a=new FormData;a.append("state",t),a.append("q","dashboard_due_invoices"),postFetch(a)}function drawGraph(e,t,a,n,r){"line"==n?Boolean(graphScriptLoaded)?(chart[e]&&"function"==typeof chart[e].destroy&&(chart[e].destroy(),console.log("Chart destroyed")),chart[e]=graph_init_line(t,a,e,r)):loadScript("https://cdn.jsdelivr.net/npm/chart.js@3.4.1",function(){graphScriptLoaded=!0,chart[e]=graph_init_line(t,a,e,r)}):"doughnut"==n&&(Boolean(graphScriptLoaded)?(chart[e]&&"function"==typeof chart[e].destroy&&(chart[e].destroy(),console.log("Chart destroyed")),chart[e]=graph_init_doughnut(t,a,e,r)):loadScript("https://cdn.jsdelivr.net/npm/chart.js@3.4.1",function(){graphScriptLoaded=!0,chart[e]=graph_init_doughnut(t,a,e,r)}))}function graph_init_line(e,t,a,n){let r=document.getElementById(a).getContext("2d");var o=[];let s=0;return Object.entries(t).forEach(function(e){o[s]={data:e[1].datas,label:e[0],borderWidth:e[1].width,borderColor:e[1].color,backgroundColor:e[1].color,radius:1,fill:e[1].fill,tension:.5},s++}),new Chart(r,{type:"line",data:{labels:e,datasets:o},options:{responsive:!0,aspectRatio:n,plugins:{legend:{labels:{font:{size:10},boxWidth:20,padding:5},onHover:function(e){e.native.target.style.cursor="pointer"},onLeave:function(e){e.native.target.style.cursor="default"}}},scales:{x:{grid:{display:!1},ticks:{font:{size:10}}},y:{display:!0,beginAtZero:!0,grid:{},ticks:{font:{size:10}}}}}})}function graph_init_doughnut(e,t,a,n){let r=document.getElementById(a).getContext("2d"),o=[],s=[],i=[],l=0;return Object.keys(e).forEach(function(a){o[l]=a,s[l]=e[a],i[l]=t[a],l++}),new Chart(r,{type:"doughnut",data:{labels:o,datasets:[{data:i,backgroundColor:s,hoverOffset:4}]},options:{responsive:!0,plugins:{legend:{labels:{font:{size:10},boxWidth:20},onHover:function(e){e.native.target.style.cursor="pointer"},onLeave:function(e){e.native.target.style.cursor="default"}}},scales:{x:{display:!1,grid:{display:!1},ticks:{font:{size:10}}},y:{display:!1,beginAtZero:!0,grid:{display:!1},ticks:{font:{size:10}}}}}})}var ratio=2.5;function callDashTopDatas(e){if(e.hasOwnProperty("tot_customers")){document.getElementById("section-one").querySelectorAll(".a-selectors button").forEach(function(e){e.disabled=0}),document.querySelector(".guests-number").innerText=e.tot_customers,document.querySelector(".incomings-number").innerText=e.tot_payments,document.querySelector(".outgoings-number").innerText=e.tot_outgoings;let t=e.tot_payments-e.tot_outgoings;document.querySelector(".earnings-number").innerText=t}}function callTopDashboardTodayChekinsOut(e){let t=totout=0;Array.from(Object.values(e)).forEach(function(e){console.log(e),"TODAY"==e[0]?"IN"==e[2]?(t+=parseInt(e[3]),1==e[1]&&(document.getElementById("today_checkins_miss").innerHTML=e[3])):"OUT"==e[2]&&(totout+=parseInt(e[3]),5==e[1]&&(document.getElementById("today_checkouts_miss").innerHTML=e[3])):"YESTERDAY"==e[0]&&("IN"==e[2]?document.getElementById("yday_checkins").innerHTML=e[3]:"OUT"==e[2]&&(document.getElementById("yday_checkouts").innerHTML=e[3]))}),document.getElementById("today_checkins").innerHTML=t,document.getElementById("today_checkouts").innerHTML=totout}function callDashOccupancy(e){Date.parse(e.sd),Date.parse(e.ed),Object.entries(roomsA).forEach(function(e){e[0],e[1][1]})}function callDashOccupancyDayByDay(e){let t=Date.parse(e.sd),a=Date.parse(e.ed),n,r,o,s=[],i={Shared:{datas:[]},Privates:{datas:[]},Total:{datas:[]}},l=(a-t)/864e5+1,d=0,c=1,u=document.getElementById("occupancy-card");for(let y=0;y<l;y++){let g=t+864e5*y;[{value:r},,{value:n},,{value:o}]=format.formatToParts(g);let $=o+"-"+r+"-"+n,p=r+"-"+n;s.push(p);let h=0,m=0;e.hasOwnProperty($)&&(e[$].hasOwnProperty("1")&&(h=e[$][1]/dorm_beds_tot),e[$].hasOwnProperty("0")&&(m=e[$][0]/priv_rooms_tot));let f=(h*dorm_beds_tot+m*priv_rooms_tot)/(dorm_beds_tot+priv_rooms_tot);isNaN(f)&&(f=0),$==today?(u.querySelector(".today-number").innerText=parseInt(100*f)+"%",document.querySelector("#today_priv_occ").innerText=parseInt(100*m)+"%",document.querySelector("#today_shar_occ").innerText=parseInt(100*h)+"%"):$==tomorrow?u.querySelector(".tomorrow-number").innerText=parseInt(100*f)+"%":$==yesterday&&(u.querySelector(".tomorrow-number").innerText=parseInt(100*f)+"%",document.querySelector("#yday_priv_occ").innerText=parseInt(100*m)+"%",document.querySelector("#yday_shar_occ").innerText=parseInt(100*h)+"%"),i.Privates.datas[y]=parseInt(100*m),i.Shared.datas[y]=parseInt(100*h),i.Total.datas[y]=parseInt(100*f),d+=f,c++}i.Privates.color="slategray",i.Privates.width=2,i.Privates.fill=!1,i.Shared.color="yellow",i.Shared.width=2,i.Shared.fill=!1,i.Total.color="coral",i.Total.width=1,i.Total.fill=!0,u.querySelector(".avearge-number").innerText=parseInt(d/c*100)+"%";getParentByClass(document.getElementById("graph_occupancy"),"top").querySelector(".wait").classList.add("hidden"),drawGraph("graph_occupancy",s,i,"line",ratio)}function callDashOccupancyByRooms(e){let t={},a="occupancy_pie",n=["rgba(255, 99, 132)","rgba(54, 162, 235)","rgba(255, 206, 86)","rgba(75, 192, 192)","rgba(153, 102, 255)","rgba(255, 159, 64)"],r=0;console.log(e),Array.from(Object.keys(e)).forEach(function(e){r<n.length&&(t[e]=n[r]),r++});let o;getParentByClass(document.getElementById(a),"top").querySelector(".wait").classList.add("hidden"),drawGraph(a,t,e,"doughnut",1.5)}function callDashEarningsDayByDay(e){let t=Date.parse(e.sd),a=Date.parse(e.ed),n,r,o,s=new Intl.DateTimeFormat("en",{year:"numeric",month:"numeric",month:"2-digit",day:"2-digit"}),i=[],l={Income:{datas:[]},Outgoings:{datas:[]},Earnings:{datas:[]}},d=(a-t)/864e5+1,c=document.getElementById("earnings-card"),u=0,y=0;for(let g=0;g<=d;g++){let $=t+864e5*g;[{value:r},,{value:n},,{value:o}]=s.formatToParts($);let p=o+"-"+r+"-"+n,h=r+"-"+n;i.push(h);let m=outgoings=0;e.incomes.hasOwnProperty(p)&&(m=e.incomes[p]),e.outgoings.hasOwnProperty(p)&&(outgoings=e.outgoings[p]);let f=m-outgoings;p==today?(c.querySelector(".today-number").innerText=f,document.querySelector("#today_payments").innerText=m,document.querySelector("#today_outgoings").innerText=outgoings,document.querySelector("#today_earnings").innerText=f):p==yesterday&&(c.querySelector(".yesterday-number").innerText=f,document.querySelector("#yday_payments").innerText=m,document.querySelector("#yday_outgoings").innerText=outgoings,document.querySelector("#yday_earnings").innerText=f),u+=parseInt(f),y++,l.Income.datas[g]=m,l.Outgoings.datas[g]=outgoings,l.Earnings.datas[g]=f}l.Income.color="slategray",l.Income.width=2,l.Income.fill=!1,l.Outgoings.color="coral",l.Outgoings.width=2,l.Outgoings.fill=!1,l.Earnings.color="lime",l.Earnings.width=1,l.Earnings.fill=!0,u=parseInt(u/y),c.querySelector(".average-number").innerText=u;getParentByClass(document.getElementById("graph_earnings"),"top").querySelector(".wait").classList.add("hidden"),drawGraph("graph_earnings",i,l,"line",ratio)}function callDashIncomingsByPaymentMethod(e){let t={},a="graph_earnings_method",n=["rgba(255, 99, 132)","rgba(54, 162, 235)","rgba(255, 206, 86)","rgba(75, 192, 192)","rgba(153, 102, 255)","rgba(255, 159, 64)"],r=0;Array.from(Object.keys(e)).forEach(function(e){r<n.length&&(t[e]=n[r]),r++});let o=document.getElementById(a),s=getParentByClass(o,"top").querySelector(".wait");if(r<1){s.innerHTML="<h4>Not enough datas</h4>";return}s.classList.add("hidden"),drawGraph(a,t,e,"doughnut",1.5)}function callDashBookingsDayByDay(e){let t=Date.parse(e.sd),a=Date.parse(e.ed),n,r,o,s=new Intl.DateTimeFormat("en",{year:"numeric",month:"numeric",month:"2-digit",day:"2-digit"}),i=[],l={},d={0:"gray",1:"#00aae7",2:"green",8:"#0419a9",9:"purple"};Object.keys(mapBookingStates).forEach(function(e){if(Object.keys(d).includes(e)){let t=mapBookingStates[e],a=d[e];l[t]={datas:[],fill:!1,width:2,color:a}}}),l.Total={datas:[],fill:!0,width:1,color:"lime"};let c=(a-t)/864e5+1,u=document.getElementById("bookings_states"),y=0,g=0;for(let $=0;$<=c;$++){let p=t+864e5*$;[{value:r},,{value:n},,{value:o}]=s.formatToParts(p);let h=o+"-"+r+"-"+n,m=r+"-"+n;i.push(m);let f=0;Object.keys(mapBookingStates).forEach(function(t){if(Object.keys(d).includes(t)){let a=mapBookingStates[t],n=0;e.hasOwnProperty(h)&&isNaN(n=e[h][t])&&(n=0),l[a].datas[$]=n,0!=t&&(f+=parseInt(n))}}),h==today?(u.querySelector(".today-number").innerText=f,document.querySelector("#today_new_bookings").innerText=f):h==yesterday&&(document.querySelector("#yday_new_bookings").innerText=f,u.querySelector(".yesterday-number").innerText=f),y+=parseInt(f),g++,l.Total.datas[$]=f}y=parseInt(y/g),u.querySelector(".average-number").innerText=y;getParentByClass(document.getElementById("graph_bookings_states"),"top").querySelector(".wait").classList.add("hidden"),drawGraph("graph_bookings_states",i,l,"line",ratio)}function callDashBookingsChannels(e){let t={},a="graph_bookings_channels",n=["rgba(255, 99, 132)","rgba(54, 162, 235)","rgba(255, 206, 86)","rgba(75, 192, 192)","rgba(153, 102, 255)","rgba(255, 159, 64)"],r=0;Array.from(Object.keys(e)).forEach(function(e){r<n.length&&(t[e]=n[r]),r++});let o=document.getElementById(a),s=getParentByClass(o,"top").querySelector(".wait");if(r<3){s.innerHTML="<h4>Not enough datas</h4>";return}s.classList.add("hidden"),drawGraph(a,t,e,"doughnut",1.5)}function callDashDueInvoices(e){let t=document.getElementById("dueinvoices_card_template"),a=document.getElementById("dueinvoices_cards_container"),n=document.getElementById("dueinvoices_count"),r=e.count;for(;a.firstChild;)a.removeChild(a.firstChild);if(0==r){n.innerText="No Due Invoices";return}n.innerText="Showing "+e.cards.length+" of "+e.count,Array.from(Object.values(e.cards)).forEach(function(e){console.log(e);let n=t.content.cloneNode(!0);n.querySelector("a").href="/workspace/booking.php?bid="+e.bid,n.querySelector("a").classList.add("st-"+e.state,"bg-st-"+e.state),n.querySelector(".due-name").innerText=e.name,n.querySelector(".due-state").innerText=booking_states[e.state],n.querySelector(".due-amount").innerText=e.balance,n.querySelector(".due-paied").innerText=e.paied,a.appendChild(n)})}window.innerWidth<600&&(ratio=1.5);var lazyGraphs={graph_bookings_channels:{state:0,init:function(){getBookingsChannels("last_30_days")}},graph_bookings_states:{state:0,init:function(){getBookingsDayByDay("last_30_days")}},graph_occupancy:{state:0,init:function(){getOccupancyDayByDay()}},occupancy_pie:{state:0,init:function(){getOccupancyByRooms()}},graph_earnings_method:{state:0,init:function(){getIncomingsByPaymentMethod("last_30_days")}},graph_earnings:{state:0,init:function(){getEarningsDayByDay("last_30_days")}}};function scrollInitListener(){document.addEventListener("scroll",onScroll)}function onScroll(e){let t=0,a=window.innerHeight;Array.from(Object.keys(lazyGraphs)).forEach(function(e){let n=document.getElementById(e),r=n.id;n.getBoundingClientRect().bottom<a&&0==lazyGraphs[r].state&&(lazyGraphs[r].state=1,lazyGraphs[r].init()),1==lazyGraphs[r].state&&t++}),t==Object.keys(lazyGraphs).length&&document.removeEventListener("scroll",onScroll)}